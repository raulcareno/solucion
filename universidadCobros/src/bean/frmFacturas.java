/*
 * frmRubros.java
 *
 * Created on 1 de noviembre de 2007, 09:10 PM
 */
package bean;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import javax.swing.DefaultListModel;
import javax.swing.JOptionPane;

import javax.swing.table.DefaultTableModel;
import jcinform.persistencia.Bancos;
import jcinform.persistencia.CarrerasMaterias;
import jcinform.persistencia.Empleados;
import jcinform.persistencia.Estudiantes;
import jcinform.persistencia.Facturas;
import jcinform.persistencia.Institucion;
import jcinform.persistencia.MateriasMatricula;
import jcinform.persistencia.Matriculas;
import jcinform.persistencia.Parametros;
import jcinform.persistencia.Parientes;
import jcinform.persistencia.Periodos;
import jcinform.persistencia.Rubros;
import jcinform.persistencia.RubrosMatriculaPeriodo;
import jcinform.procesos.Administrador;
import util.general;

/**
 *
 * @author Francisco
 */
public class frmFacturas extends javax.swing.JInternalFrame {

    public boolean grabar = false;
    public boolean modificar = false;
    Administrador adm;
    public Periodos periodoActual;
    public Empleados empleadoActual;
    List<Parametros> parametrosList = null;
     public Institucion inst;
    public Matriculas actualMatricula;

    /**
     * Creates new form frmRubros
     */
    public frmFacturas() {
        initComponents();

    }

    public frmFacturas(Administrador adm1) {

        adm = adm1;
        this.initComponents();

        frmActualizar.setVisible(false);
        panelencontrados1.setVisible(false);
        codigoPariente.setVisible(false);
        cargarBancos();
    }

    private void cargarBancos() {
        bancoA.removeAllItems();

        general gen = new general(-1, "Seleccione..");
        bancoA.addItem(gen);
        List<Bancos> bancosList = adm.query("Select o from Bancos as o ");
        for (Iterator<Bancos> it = bancosList.iterator(); it.hasNext();) {
            Bancos bancos = it.next();
            gen = new general(bancos.getIdBancos(), bancos.getNombre());
            bancoA.addItem(gen);

        }
        bancosList = null;

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        buttonGroup2 = new javax.swing.ButtonGroup();
        frmActualizar = new javax.swing.JPanel();
        ruc1 = new javax.swing.JFormattedTextField();
        nombre1 = new javax.swing.JFormattedTextField();
        direccion1 = new javax.swing.JFormattedTextField();
        telefono1 = new javax.swing.JFormattedTextField();
        jLabel11 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        jLabel13 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        btnGuardarCerra = new javax.swing.JButton();
        panelencontrados1 = new javax.swing.JPanel();
        jScrollPane8 = new javax.swing.JScrollPane();
        encontrados1 = new javax.swing.JList();
        jScrollPane1 = new javax.swing.JScrollPane();
        tFactura = new javax.swing.JTable();
        jPanel1 = new javax.swing.JPanel();
        btnNuevo = new javax.swing.JButton();
        btnModificar = new javax.swing.JButton();
        btnSalir = new javax.swing.JButton();
        btnEliminar = new javax.swing.JButton();
        jDateChooser1 = new com.toedter.calendar.JDateChooser();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        telefono = new javax.swing.JLabel();
        carrera = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        editarDatos = new javax.swing.JButton();
        buscarApellido = new javax.swing.JFormattedTextField();
        jLabel7 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        ruc = new javax.swing.JLabel();
        nombre = new javax.swing.JLabel();
        direccion = new javax.swing.JLabel();
        codigoPariente = new javax.swing.JFormattedTextField();
        subtotal = new javax.swing.JLabel();
        total1 = new javax.swing.JLabel();
        iva = new javax.swing.JLabel();
        total = new javax.swing.JLabel();
        total4 = new javax.swing.JLabel();
        total5 = new javax.swing.JLabel();
        chkTodo = new javax.swing.JRadioButton();
        chkMatricula = new javax.swing.JRadioButton();
        chkCreditos = new javax.swing.JRadioButton();
        jLabel15 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();
        categoriaSocial = new javax.swing.JLabel();
        descuento2 = new javax.swing.JLabel();
        total7 = new javax.swing.JLabel();
        total8 = new javax.swing.JLabel();
        chkNuevo = new javax.swing.JRadioButton();
        chkAntiguo = new javax.swing.JRadioButton();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        factura = new javax.swing.JFormattedTextField();
        valorA = new javax.swing.JFormattedTextField();
        fechaA = new com.toedter.calendar.JDateChooser();
        referenciaA = new javax.swing.JFormattedTextField();
        bancoA = new javax.swing.JComboBox();
        total6 = new javax.swing.JLabel();
        total9 = new javax.swing.JLabel();
        total10 = new javax.swing.JLabel();
        total11 = new javax.swing.JLabel();
        confirmadoA = new javax.swing.JCheckBox();
        anadir = new javax.swing.JButton();
        total12 = new javax.swing.JLabel();
        tipoA = new javax.swing.JComboBox();
        jScrollPane2 = new javax.swing.JScrollPane();
        formasdePago = new javax.swing.JTable();
        totalCobros = new javax.swing.JLabel();
        total3 = new javax.swing.JLabel();
        total13 = new javax.swing.JLabel();
        descuento = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        total14 = new javax.swing.JLabel();

        setBackground(new java.awt.Color(236, 246, 255));
        setTitle("Facturación");
        setFrameIcon(new javax.swing.ImageIcon(getClass().getResource("/images/rubros.gif"))); // NOI18N
        getContentPane().setLayout(null);

        frmActualizar.setLayout(null);

        ruc1.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        ruc1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                ruc1KeyPressed(evt);
            }
        });
        frmActualizar.add(ruc1);
        ruc1.setBounds(79, 10, 110, 20);

        nombre1.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        nombre1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                nombre1KeyPressed(evt);
            }
        });
        frmActualizar.add(nombre1);
        nombre1.setBounds(79, 30, 220, 20);

        direccion1.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        direccion1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                direccion1KeyPressed(evt);
            }
        });
        frmActualizar.add(direccion1);
        direccion1.setBounds(79, 50, 220, 20);

        telefono1.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        telefono1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                telefono1KeyPressed(evt);
            }
        });
        frmActualizar.add(telefono1);
        telefono1.setBounds(79, 70, 170, 20);

        jLabel11.setText("RUC: ");
        frmActualizar.add(jLabel11);
        jLabel11.setBounds(10, 10, 80, 14);

        jLabel12.setText("NOMBRES: ");
        frmActualizar.add(jLabel12);
        jLabel12.setBounds(10, 30, 80, 14);

        jLabel13.setText("DIRECCIÓN:");
        frmActualizar.add(jLabel13);
        jLabel13.setBounds(10, 50, 80, 14);

        jLabel14.setText("TELÉFONO:");
        frmActualizar.add(jLabel14);
        jLabel14.setBounds(10, 70, 80, 14);

        btnGuardarCerra.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/guardar.png"))); // NOI18N
        btnGuardarCerra.setText("Guardar y Cerrar");
        btnGuardarCerra.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGuardarCerraActionPerformed(evt);
            }
        });
        frmActualizar.add(btnGuardarCerra);
        btnGuardarCerra.setBounds(80, 92, 133, 23);

        getContentPane().add(frmActualizar);
        frmActualizar.setBounds(0, 20, 310, 120);

        panelencontrados1.setBackground(javax.swing.UIManager.getDefaults().getColor("Button.light"));
        panelencontrados1.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        panelencontrados1.setLayout(null);

        encontrados1.setModel(new javax.swing.AbstractListModel() {
            String[] strings = { "Estudiantes..." };
            public int getSize() { return strings.length; }
            public Object getElementAt(int i) { return strings[i]; }
        });
        encontrados1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        encontrados1.setAlignmentX(0.2F);
        encontrados1.setVisibleRowCount(10);
        encontrados1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                encontrados1MouseClicked(evt);
            }
        });
        encontrados1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                encontrados1KeyPressed(evt);
            }
        });
        jScrollPane8.setViewportView(encontrados1);

        panelencontrados1.add(jScrollPane8);
        jScrollPane8.setBounds(10, 10, 260, 170);

        getContentPane().add(panelencontrados1);
        panelencontrados1.setBounds(90, 20, 280, 190);

        tFactura.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Código", "Nombre", "Cantidad", "V.Nuevo"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.Double.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tFactura.setSelectionBackground(new java.awt.Color(236, 246, 255));
        tFactura.setSelectionForeground(new java.awt.Color(0, 0, 0));
        tFactura.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tFacturaMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tFactura);
        tFactura.getColumnModel().getColumn(0).setMinWidth(0);
        tFactura.getColumnModel().getColumn(0).setPreferredWidth(0);
        tFactura.getColumnModel().getColumn(0).setMaxWidth(0);
        tFactura.getColumnModel().getColumn(1).setResizable(false);
        tFactura.getColumnModel().getColumn(1).setPreferredWidth(200);
        tFactura.getColumnModel().getColumn(2).setResizable(false);
        tFactura.getColumnModel().getColumn(2).setPreferredWidth(0);
        tFactura.getColumnModel().getColumn(3).setResizable(false);

        getContentPane().add(jScrollPane1);
        jScrollPane1.setBounds(20, 140, 580, 130);

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        jPanel1.setLayout(null);

        btnNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/new.gif"))); // NOI18N
        btnNuevo.setText("Nuevo");
        btnNuevo.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        btnNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNuevoActionPerformed(evt);
            }
        });
        jPanel1.add(btnNuevo);
        btnNuevo.setBounds(10, 10, 105, 30);

        btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/modificar.gif"))); // NOI18N
        btnModificar.setText("Modificar");
        btnModificar.setEnabled(false);
        btnModificar.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        btnModificar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnModificarActionPerformed(evt);
            }
        });
        jPanel1.add(btnModificar);
        btnModificar.setBounds(120, 10, 110, 30);

        btnSalir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/exit.gif"))); // NOI18N
        btnSalir.setText("Salir");
        btnSalir.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        btnSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSalirActionPerformed(evt);
            }
        });
        jPanel1.add(btnSalir);
        btnSalir.setBounds(350, 10, 105, 30);

        btnEliminar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/cancel.gif"))); // NOI18N
        btnEliminar.setText("Anular");
        btnEliminar.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });
        jPanel1.add(btnEliminar);
        btnEliminar.setBounds(240, 10, 105, 30);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(130, 480, 480, 50);

        jDateChooser1.setDate(new Date());
        getContentPane().add(jDateChooser1);
        jDateChooser1.setBounds(460, 90, 140, 28);

        jLabel1.setText("Fecha: ");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(410, 90, 50, 30);

        jLabel2.setText("Búsqueda: ");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(10, 0, 70, 14);

        telefono.setText(".");
        getContentPane().add(telefono);
        telefono.setBounds(90, 80, 230, 14);

        carrera.setText(".");
        getContentPane().add(carrera);
        carrera.setBounds(90, 100, 510, 20);

        jLabel5.setText("NOMBRES: ");
        getContentPane().add(jLabel5);
        jLabel5.setBounds(10, 40, 80, 14);

        jLabel6.setText("DIRECCIÓN:");
        getContentPane().add(jLabel6);
        jLabel6.setBounds(10, 60, 80, 14);

        editarDatos.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        editarDatos.setText("EDITAR");
        editarDatos.setMargin(new java.awt.Insets(0, 0, 0, 0));
        editarDatos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                editarDatosActionPerformed(evt);
            }
        });
        getContentPane().add(editarDatos);
        editarDatos.setBounds(230, 20, 70, 23);

        buscarApellido.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        buscarApellido.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                buscarApellidoFocusGained(evt);
            }
        });
        buscarApellido.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                buscarApellidoKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                buscarApellidoKeyReleased(evt);
            }
        });
        getContentPane().add(buscarApellido);
        buscarApellido.setBounds(90, 0, 280, 21);

        jLabel7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/fondoInicio.jpg"))); // NOI18N
        getContentPane().add(jLabel7);
        jLabel7.setBounds(0, 0, 630, 20);

        jLabel9.setText("RUC: ");
        getContentPane().add(jLabel9);
        jLabel9.setBounds(10, 20, 80, 14);

        ruc.setText(".");
        getContentPane().add(ruc);
        ruc.setBounds(90, 20, 140, 14);

        nombre.setText(".");
        getContentPane().add(nombre);
        nombre.setBounds(90, 40, 230, 14);

        direccion.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        direccion.setText(". ");
        getContentPane().add(direccion);
        direccion.setBounds(90, 60, 320, 13);
        getContentPane().add(codigoPariente);
        codigoPariente.setBounds(130, 120, 20, 20);

        subtotal.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        subtotal.setForeground(new java.awt.Color(51, 51, 51));
        subtotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        subtotal.setText("00.00");
        getContentPane().add(subtotal);
        subtotal.setBounds(100, 270, 70, 30);

        total1.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        total1.setForeground(new java.awt.Color(51, 51, 51));
        total1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total1.setText("TOTAL:");
        getContentPane().add(total1);
        total1.setBounds(420, 270, 70, 30);

        iva.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        iva.setForeground(new java.awt.Color(51, 51, 51));
        iva.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        iva.setText("00.00");
        getContentPane().add(iva);
        iva.setBounds(350, 270, 70, 30);

        total.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        total.setForeground(new java.awt.Color(0, 51, 153));
        total.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total.setText("00.00");
        getContentPane().add(total);
        total.setBounds(490, 270, 110, 30);

        total4.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        total4.setForeground(new java.awt.Color(51, 51, 51));
        total4.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        total4.setText("Confirmado");
        getContentPane().add(total4);
        total4.setBounds(440, 300, 80, 20);

        total5.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        total5.setForeground(new java.awt.Color(51, 51, 51));
        total5.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total5.setText("IVA:");
        getContentPane().add(total5);
        total5.setBounds(310, 270, 40, 30);

        buttonGroup1.add(chkTodo);
        chkTodo.setSelected(true);
        chkTodo.setText("Todo");
        chkTodo.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                chkTodoMouseClicked(evt);
            }
        });
        chkTodo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkTodoActionPerformed(evt);
            }
        });
        getContentPane().add(chkTodo);
        chkTodo.setBounds(390, 50, 70, 23);

        buttonGroup1.add(chkMatricula);
        chkMatricula.setText("Matricula");
        chkMatricula.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkMatriculaActionPerformed(evt);
            }
        });
        getContentPane().add(chkMatricula);
        chkMatricula.setBounds(460, 50, 80, 23);

        buttonGroup1.add(chkCreditos);
        chkCreditos.setText("Créditos");
        chkCreditos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkCreditosActionPerformed(evt);
            }
        });
        getContentPane().add(chkCreditos);
        chkCreditos.setBounds(540, 50, 80, 23);

        jLabel15.setText("TELÉFONO:");
        getContentPane().add(jLabel15);
        jLabel15.setBounds(10, 80, 80, 14);

        jLabel16.setText("CARRERA:");
        getContentPane().add(jLabel16);
        jLabel16.setBounds(10, 100, 80, 14);

        categoriaSocial.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        categoriaSocial.setForeground(new java.awt.Color(51, 51, 51));
        categoriaSocial.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        categoriaSocial.setText("A");
        getContentPane().add(categoriaSocial);
        categoriaSocial.setBounds(90, 120, 20, 20);

        descuento2.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        descuento2.setForeground(new java.awt.Color(204, 51, 0));
        descuento2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        descuento2.setText("00.00");
        getContentPane().add(descuento2);
        descuento2.setBounds(90, 440, 70, 30);

        total7.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        total7.setForeground(new java.awt.Color(51, 51, 51));
        total7.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total7.setText("Dscto.");
        getContentPane().add(total7);
        total7.setBounds(180, 270, 50, 30);

        total8.setForeground(new java.awt.Color(51, 51, 51));
        total8.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        total8.setText("CATEGORÍA:");
        getContentPane().add(total8);
        total8.setBounds(10, 120, 80, 20);

        buttonGroup2.add(chkNuevo);
        chkNuevo.setSelected(true);
        chkNuevo.setText("Nuevo");
        chkNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkNuevoActionPerformed(evt);
            }
        });
        getContentPane().add(chkNuevo);
        chkNuevo.setBounds(460, 70, 70, 23);

        buttonGroup2.add(chkAntiguo);
        chkAntiguo.setText("Antiguo");
        chkAntiguo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                chkAntiguoActionPerformed(evt);
            }
        });
        getContentPane().add(chkAntiguo);
        chkAntiguo.setBounds(540, 70, 80, 23);

        jLabel3.setText("Estudiante:");
        getContentPane().add(jLabel3);
        jLabel3.setBounds(400, 70, 70, 20);

        jLabel4.setText("Factura:");
        getContentPane().add(jLabel4);
        jLabel4.setBounds(410, 20, 60, 14);

        factura.setText("FC0000000");
        factura.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                facturaFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                facturaFocusLost(evt);
            }
        });
        getContentPane().add(factura);
        factura.setBounds(470, 20, 150, 25);

        valorA.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        valorA.setText("0.00");
        valorA.setEnabled(false);
        valorA.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        valorA.setMargin(new java.awt.Insets(0, 0, 0, 0));
        valorA.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                valorAKeyPressed(evt);
            }
        });
        getContentPane().add(valorA);
        valorA.setBounds(130, 320, 60, 28);

        fechaA.setEnabled(false);
        fechaA.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        fechaA.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                fechaAKeyPressed(evt);
            }
        });
        getContentPane().add(fechaA);
        fechaA.setBounds(340, 320, 130, 28);

        referenciaA.setEnabled(false);
        referenciaA.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        referenciaA.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                referenciaAKeyPressed(evt);
            }
        });
        getContentPane().add(referenciaA);
        referenciaA.setBounds(270, 320, 70, 28);

        bancoA.setFont(new java.awt.Font("Tahoma", 0, 10)); // NOI18N
        bancoA.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Pichincha", " " }));
        bancoA.setEnabled(false);
        bancoA.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                bancoAKeyPressed(evt);
            }
        });
        getContentPane().add(bancoA);
        bancoA.setBounds(200, 320, 70, 28);

        total6.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        total6.setForeground(new java.awt.Color(51, 51, 51));
        total6.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total6.setText("Subtotal:");
        getContentPane().add(total6);
        total6.setBounds(20, 270, 80, 30);

        total9.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        total9.setForeground(new java.awt.Color(51, 51, 51));
        total9.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        total9.setText("Tipo:");
        getContentPane().add(total9);
        total9.setBounds(40, 300, 60, 20);

        total10.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        total10.setForeground(new java.awt.Color(51, 51, 51));
        total10.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        total10.setText("Banco");
        getContentPane().add(total10);
        total10.setBounds(200, 300, 60, 20);

        total11.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        total11.setForeground(new java.awt.Color(51, 51, 51));
        total11.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        total11.setText("Referencia");
        getContentPane().add(total11);
        total11.setBounds(270, 300, 70, 20);

        confirmadoA.setEnabled(false);
        getContentPane().add(confirmadoA);
        confirmadoA.setBounds(470, 320, 30, 28);

        anadir.setText("Añadir");
        anadir.setToolTipText("");
        anadir.setEnabled(false);
        anadir.setMargin(new java.awt.Insets(0, 0, 0, 0));
        anadir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                anadirActionPerformed(evt);
            }
        });
        getContentPane().add(anadir);
        anadir.setBounds(513, 320, 90, 28);

        total12.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        total12.setForeground(new java.awt.Color(51, 51, 51));
        total12.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        total12.setText("Valor:");
        getContentPane().add(total12);
        total12.setBounds(130, 300, 60, 20);

        tipoA.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Seleccione:", "Efectivo", "Descuento", "Cheque", "Debito", "Tarjeta", "Transferencia" }));
        tipoA.setEnabled(false);
        tipoA.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                tipoAItemStateChanged(evt);
            }
        });
        getContentPane().add(tipoA);
        tipoA.setBounds(30, 320, 100, 28);

        formasdePago.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Tipo", "Valor", "Banco", "Referencia", "Fecha", "Confirmado"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Double.class, java.lang.Object.class, java.lang.String.class, java.util.Date.class, java.lang.Boolean.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        formasdePago.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                formasdePagoKeyPressed(evt);
            }
        });
        jScrollPane2.setViewportView(formasdePago);

        getContentPane().add(jScrollPane2);
        jScrollPane2.setBounds(20, 350, 580, 90);

        totalCobros.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        totalCobros.setForeground(new java.awt.Color(0, 51, 153));
        totalCobros.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        totalCobros.setText("00.00");
        getContentPane().add(totalCobros);
        totalCobros.setBounds(260, 440, 90, 30);

        total3.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        total3.setForeground(new java.awt.Color(51, 51, 51));
        total3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total3.setText("Dstos.:");
        getContentPane().add(total3);
        total3.setBounds(20, 440, 60, 30);

        total13.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        total13.setForeground(new java.awt.Color(51, 51, 51));
        total13.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        total13.setText("A COBRAR:");
        getContentPane().add(total13);
        total13.setBounds(180, 440, 80, 30);

        descuento.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        descuento.setForeground(new java.awt.Color(204, 51, 0));
        descuento.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        descuento.setText("00.00");
        getContentPane().add(descuento);
        descuento.setBounds(230, 270, 70, 30);

        jLabel8.setText("Presione SUPR para quitar");
        getContentPane().add(jLabel8);
        jLabel8.setBounds(420, 440, 180, 14);

        total14.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        total14.setForeground(new java.awt.Color(51, 51, 51));
        total14.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        total14.setText("Fecha Cheque");
        getContentPane().add(total14);
        total14.setBounds(340, 300, 110, 20);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSalirActionPerformed
// TODO add your handling code here:
        if (grabar == true) {
            grabar = false;
            modificar = false;

            this.btnNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/agregar.png")));
            this.btnNuevo.setLabel("Nuevo");
            this.btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/modificar.gif")));
            this.btnModificar.setLabel("Modificar");
//            this.txtNombre.setEnabled(false);
        }
        this.setVisible(false);
    }//GEN-LAST:event_btnSalirActionPerformed
public void llenarFactura(){
         inst = (Institucion)adm.buscarClave(inst.getIdInstitucion(), Institucion.class);
        Long valor = Long.parseLong(inst.getFactura1()) + 1;
        String asFac = String.format("%07d", valor);
        this.factura.setText("" + asFac);
                     
}
    private void btnNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnNuevoActionPerformed
// TODO add your handling code here:

        if (grabar == false) {
            EstudianteSeleccionado = new general("0", "");
            DefaultTableModel dtm = (DefaultTableModel) formasdePago.getModel();
            dtm.getDataVector().removeAllElements();
            formasdePago.setModel(dtm);
             dtm = (DefaultTableModel) tFactura.getModel();
            dtm.getDataVector().removeAllElements();
            tFactura.setModel(dtm);
            formasdePago.repaint();
            tFactura.repaint();
            chkTodo.setSelected(true);
            chkNuevo.setSelected(true);
            codigoPariente.setText("0"); 
            ruc.setText(".");
            nombre.setText(".");
            direccion.setText(".");
            telefono.setText(".");
            carrera.setText("."); 
            llenarFactura();
            this.btnNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/guardar.png")));
            this.btnNuevo.setLabel("Guardar");
            this.btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/cancelar.png")));
            this.btnModificar.setLabel("Cancelar");
            this.btnModificar.setEnabled(true);

            grabar = true;
            modificar = false;
        } else if (grabar == true) {
                     
                Facturas cab = new Facturas();
//                secuencial sec = new secuencial();
                inst = (Institucion)adm.buscarClave(inst.getIdInstitucion(), Institucion.class);
 
 
                    //FACTURAS
                         Date fecha = adm.Date();
                        cab.setFecha(fecha);
                        cab.setFechaEmision(fecha);
                        cab.setFechaVence(fecha);
                        cab.setIdMatriculas((Matriculas) txtEstudiante.getSelectedItem());
                        cab.setFacTotal(Double.parseDouble(this.txtTotalFacturas.getText()));
                        cab.setFacEstado(true);
                        String sucursal = (String) this.cmbSucursal.getSelectedItem();
                        cab.setFacNumero(sucursal + this.noFactura.getText());
                        //cab.setFacNumero(this.noFactura.getText());
                        cab.setFacObservacion(this.observacion.getText());
                        bs.guardar(cab);
                        //ACTUALIZAR DOCUMENTO FACTURA
                        //ACTUALIZAR DOCUMENTO FACTURA
                        if (cmbSucursal.getSelectedIndex() == 0) {
                            documento.setFactura(noFactura.getText().trim());
                        } else if (cmbSucursal.getSelectedIndex() == 1) {
                            documento.setFactura1(noFactura.getText().trim());
                        } else if (cmbSucursal.getSelectedIndex() == 2) {
                            documento.setFactura2(noFactura.getText().trim());
                        }
                        bs.actualizar(documento);


                        for (int i = 0; i < this.tFactura.getRowCount(); i++) {
                            if ((Boolean) tFactura.getValueAt(i, 4) == true) {
                                String mess = (String) tFactura.getValueAt(i, 2);
                                Detallefactura det = new Detallefactura();
//                                        DetallefacturaPK pks = new DetallefacturaPK();
                                Integer anio = (Integer) tFactura.getValueAt(i, 3);
//                                        pks.setDetCodigo((i+1)+"");
                                det.setDetCodigo(sec.generarClave());
                                det.setFacNumero(cab);
//                                        det.setDetallefacturaPK(pks);
                                det.setDetCantidad(1);
                                det.setDetMes(val.mesint(mess.trim()));
                                det.setDetAnio(anio);
                                det.setDetDescripcion(((Productos) tFactura.getValueAt(i, 1)).getDescripcion());
                                det.setProducto((Productos) tFactura.getValueAt(i, 1));
                                det.setDetPrecio((Double) tFactura.getValueAt(i, 5));
                                det.setBeca((Double) tFactura.getValueAt(i, 6));
                                det.setDescuento((Double) tFactura.getValueAt(i, 7));
                                det.setDetTotal((Double) tFactura.getValueAt(i, 8));
                                det.setAsignado((Integer) tFactura.getValueAt(i, 0));

                                bs.guardar(det);
                                Double valorPagado = (Double) tFactura.getValueAt(i, 5);
                                String feString = anio + "-" + val.mesint(mess.trim()) + "-" + 01;
                                Matriculas matricula = (Matriculas) txtEstudiante.getSelectedItem();
                                List asignado = bs.query("SELECT o FROM Asignados AS o "
                                        + "WHERE o.asigCodigo ='" + ((Integer) tFactura.getValueAt(i, 0)) + "' ");


                                Asignados rubroA = (Asignados) asignado.get(0);
//                                        rubroA.setActivo(false);
                                rubroA.setEstado(false);
                                bs.actualizar(rubroA);

                            }
                        }
                        //FACTURAS
                     
                
                }

                grabar = false;
                modificar = false;
                this.btnNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/new.gif")));
                this.btnNuevo.setLabel("Nuevo");
                this.btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/modificar.gif")));
                this.btnModificar.setLabel("Modificar");
                this.btnModificar.setEnabled(false); 
                grabar = false;
                modificar = false;

    }//GEN-LAST:event_btnNuevoActionPerformed

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarActionPerformed
// TODO add your handling code here:
    }//GEN-LAST:event_btnEliminarActionPerformed

    private void btnModificarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnModificarActionPerformed
// TODO add your handling code here:
        if (grabar == false) {
//            if (codigoRubro.getText().isEmpty()) {
//                return;
//            }

            this.btnNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/guardar.png")));
            this.btnNuevo.setLabel("Guardar");
            this.btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/cancelar.png")));
            this.btnModificar.setLabel("Cancelar");
            modificar = true;
            grabar = true;
        } else {
            grabar = false;
            modificar = false;

            this.btnNuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/agregar.png")));
            this.btnNuevo.setLabel("Nuevo");
            this.btnModificar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/modificar.gif")));
            this.btnModificar.setLabel("Modificar");
            this.btnModificar.setEnabled(false); 

        }

    }//GEN-LAST:event_btnModificarActionPerformed

    private void tFacturaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tFacturaMouseClicked
// TODO add your handling code here:
//        int fila = tableRubros.getSelectedRow();
        //boolean val = new Boolean(tableRubros.getValueAt(fila, 3).toString());
//        this.chkEscredito.setSelected(Boolean.valueOf(val));
//        this.codigoContable.setText((String) this.tableRubros.getValueAt(fila, 4));
//        this.unidadContable.setText((String) this.tableRubros.getValueAt(fila, 5));
        //boolean val2 = new Boolean(.toString());
//        this.chkEstado.setSelected((Boolean)tableRubros.getValueAt(fila,3));
    }//GEN-LAST:event_tFacturaMouseClicked
    private void sumar() {
        int filas = tFactura.getRowCount();
        tipoA.setEnabled(false);
        BigDecimal totalCalc = new BigDecimal(0);
        for (int i = 0; i < filas; i++) {
            totalCalc = totalCalc.add((BigDecimal) tFactura.getValueAt(i, 3));
        }
        this.subtotal.setText(totalCalc + "");
        if (totalCalc.doubleValue() > 0) {
            tipoA.setEnabled(true);
        }
        BigDecimal valorIva = regresaVariableParametrosDecimal("IVA", parametrosList);
        if (valorIva.doubleValue() > 0) {
            iva.setText(valorIva.divide(new BigDecimal(100), 2, RoundingMode.HALF_UP).multiply(totalCalc).setScale(2, RoundingMode.HALF_UP) + "");
            total5.setText("IVA " + valorIva + "%:");
            //BigDecimal subtotalLocal = new BigDecimal(subtotal.getText());
            BigDecimal totalLocal = totalCalc.subtract(new BigDecimal(descuento2.getText())).multiply(valorIva.divide(new BigDecimal(100), 2, RoundingMode.HALF_UP)).add(totalCalc);
            total.setText(totalLocal.setScale(2, RoundingMode.HALF_UP) + "");
//            fac.setDescuento(new BigDecimal(0));
//                fac.setBaseiva(valor.subtract(object.getDescuento()));
//                fac.setPorcentajeiva(suc.getEmpresa().getIva());
//                fac.setValoriva(valor.subtract(object.getDescuento()).multiply(suc.getEmpresa().getIva().divide(new BigDecimal(100), 2, RoundingMode.HALF_UP)));
//                fac.setTotal(fac.getValoriva().add(fac.getSubtotal()));
//                adm.guardar(fac);
//                Detalle det = new Detalle(adm.getNuevaClave("Detalle", "codigo"));
//                det.setTotal(new BigDecimal(redondear(object.getPlan().getValor(), 2)).subtract(object.getDescuento()));
//                det.setPlan(object.getPlan());
//                det.setCantidad(1);

        }


    }

    public Double redondear(Double numero, int decimales) {
        try {
            BigDecimal d = new BigDecimal(numero);
            d = d.setScale(decimales, RoundingMode.HALF_UP);
            return d.doubleValue();
        } catch (Exception e) {
            return 0.0;
        }
    }

    public String regresaVariableString(String variable, List<Parametros> textos) {
        String dato = "";
        for (Iterator<Parametros> it = textos.iterator(); it.hasNext();) {
            Parametros textos1 = it.next();
            if (textos1.getVariable().equals(variable)) {
                return textos1.getVCaracter();
            }
        }
        return dato;
    }

    public BigDecimal regresaVariableParametrosDecimal(String variable, List<Parametros> textos) {
        for (Iterator<Parametros> it = textos.iterator(); it.hasNext();) {
            Parametros textos1 = it.next();
            if (textos1.getVariable().equals(variable)) {
                return textos1.getVNumerico();
            }
        }

        return new BigDecimal(0);
    }

    public Boolean regresaVariableParametrosLogico(String variable, List<Parametros> textos) {
        for (Iterator<Parametros> it = textos.iterator(); it.hasNext();) {
            Parametros textos1 = it.next();
            if (textos1.getVariable().equals(variable)) {
                return textos1.getVLogico();
            }
        }
        return false;
    }
Estudiantes es =null;
public general EstudianteSeleccionado = null;
    private void cargarRubros(general gen) {
        if(gen.getCodigoString().equals("0")){
            return;
        }
        es = (Estudiantes) adm.buscarClave(gen.getCodigoString(), Estudiantes.class);
        Parientes factura = new Parientes();
        if (es.getIdParientes().getTipoRepresentante().equals("F")) {
            factura = es.getIdParientes();
        } else if (es.getParIdParientes().getTipoRepresentante().equals("F")) {
            factura = es.getParIdParientes();
        } else if (es.getParIdParientes2().getTipoRepresentante().equals("F")) {
            factura = es.getParIdParientes2();
        }
        codigoPariente.setText(factura.getIdParientes() + "");
        ruc.setText(factura.getIdentificacion());
        nombre.setText(factura.getNombres());
        direccion.setText(factura.getDireccion());
        telefono.setText(factura.getTelefonoTrabajo());
        ruc1.setText(factura.getIdentificacion());
        nombre1.setText(factura.getNombres());
        direccion1.setText(factura.getDireccion());
        telefono1.setText(factura.getTelefonoTrabajo());

        List<Matriculas> matriculaList = adm.query("Select o from Matriculas as o "
                + " where o.idEstudiantes.idEstudiantes = '" + es.getIdEstudiantes() + "' "
                + " and o.idPeriodos.idPeriodos = '" + periodoActual.getIdPeriodos() + "' ");


        if (parametrosList == null) {
            parametrosList = adm.query("Select o from Parametros as o "
                    + " where o.idPeriodos.idPeriodos = '" + periodoActual.getIdPeriodos() + "' ");
        }
        if (matriculaList.size() > 0) {

             actualMatricula = matriculaList.get(0);
            carrera.setText("" + actual.getIdCarreras().getNombre() + " " + actual.getIdCarreras().getIdEscuela().getNombre() + " " + " " + actual.getIdCarreras().getIdJornada().getNombre() + " " + " " + actual.getIdCarreras().getIdModalidad().getNombre() + " ");
            categoriaSocial.setText("" + actual.getIdCategoriasSociales().getNombre());
            //VERIFICO SI ES QUE HA PAGADO UNO O VARIOS DE ESTOS RUBROS PARA PROCEDER A CAMBIARLE EL ESTADO A LA MATRICULA Y NO PAGUE 
//            List<Facturas> facturaLista = adm.query("Select o from Detalles");

            //tengo que verificar si el estado esta null o false y le cargo los rubros que se encuetnra en matricula
            //de acuerdo a la carrera y al perido actual buscando en rbrosMatriculasPeriodo
            if (actual.getPagada() == null) {
                actual.setPagada(false);

            }
            DefaultTableModel dtm = (DefaultTableModel) this.tFactura.getModel();
            dtm.getDataVector().removeAllElements();
            //no ha estado pagada
            if (chkMatricula.isSelected() || chkTodo.isSelected()) {
                if (actual.getPagada() == false) {
                    //AQUÍ HE BUSCADO LOS RUBROS QUE ESTÁN ASIGNADOS PARA LA MATRICULA
                    List<RubrosMatriculaPeriodo> rubros = adm.query("Select o from RubrosMatriculaPeriodo as o "
                            + " where o.idPeriodos.idPeriodos = '" + actual.getIdPeriodos().getIdPeriodos() + "' and "
                            + "o.idCarreras.idCarreras = '" + actual.getIdCarreras().getIdCarreras() + "' ");
                    for (Iterator<RubrosMatriculaPeriodo> it = rubros.iterator(); it.hasNext();) {
                        RubrosMatriculaPeriodo elem = it.next();
                        Object[] obj = new Object[20];
                        obj[0] = elem.getIdRubros().getIdRubros();
                        obj[1] = elem.getIdRubros().getNombre();
                        obj[2] = 1;
                        obj[3] = (chkNuevo.isSelected() ? elem.getValorNueva() : elem.getValorAntigua());
                        dtm.addRow(obj);
                    }
                }
            }
            if (chkCreditos.isSelected() || chkTodo.isSelected()) {

                //BUSCO LAS MATERIAS QUE ESTÁ TOMANDO PARA PROCEDER A FACTURAR LOS CRÉDITOS
                List<MateriasMatricula> rubrosCreditos = adm.query("Select o from MateriasMatricula as o "
                        + " where o.idMatriculas.idMatriculas = '" + actual.getIdMatriculas() + "' ");
                int creditos = 0;
                for (Iterator<MateriasMatricula> it = rubrosCreditos.iterator(); it.hasNext();) {
                    MateriasMatricula materiasMatricula = it.next();
                    List<CarrerasMaterias> noCreditos = adm.query("SELECT o FROM CarrerasMaterias as o "
                            + " WHERE o.idCarreras.idCarreras = " + materiasMatricula.getIdMatriculas().getIdCarreras().getIdCarreras() + " "
                            + " AND o.idMaterias.idMaterias = '" + materiasMatricula.getIdMaterias().getIdMaterias() + "' ");
                    if (noCreditos.size() > 0) {
                        CarrerasMaterias carM = noCreditos.get(0);
                        creditos += carM.getNumeroCreditos();
                    }

                }
                if (creditos > 0) {
                    Rubros rubroCredito = null;
                    List<Rubros> rub = adm.query("Select o from Rubros as o where o.eselcredito = true ");
                    if (rub.size() > 0) {
                        rubroCredito = rub.get(0);
                    }//no existe el crédito
                    Object[] obj = new Object[20];
                    obj[0] = rubroCredito.getIdRubros();
                    obj[1] = rubroCredito.getNombre();
                    obj[2] = creditos;
                    obj[3] = actual.getIdCategoriasSociales().getValorCredito().multiply(new BigDecimal(creditos));
                    dtm.addRow(obj);

                }

            }
            tFactura.setModel(dtm);
            sumar();

        } else {
            JOptionPane.showMessageDialog(this, "Estudiante no se encuentra matriculado", "JC INFORM", JOptionPane.ERROR_MESSAGE);
        }


    }
    private void encontrados1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_encontrados1MouseClicked
        // TODO add your handling code here:
        if (evt.getClickCount() == 2) {
            this.panelencontrados1.setVisible(false);
            EstudianteSeleccionado = (general) this.encontrados1.getSelectedValue();
            cargarRubros(EstudianteSeleccionado);
            buscarApellido.setText("");
        }
    }//GEN-LAST:event_encontrados1MouseClicked

    private void encontrados1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_encontrados1KeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            this.panelencontrados1.setVisible(false);
            EstudianteSeleccionado = (general) this.encontrados1.getSelectedValue();
            cargarRubros(EstudianteSeleccionado);
            buscarApellido.setText("");

        } else if (evt.getKeyCode() == evt.VK_UP && encontrados1.getSelectedIndex() == 0) {
            this.buscarApellido.requestFocusInWindow();
        } else if (evt.getKeyCode() == evt.VK_ESCAPE) {
            this.panelencontrados1.setVisible(false);

        } else {
            //principal.tecla(evt.getKeyCode());
        }
    }//GEN-LAST:event_encontrados1KeyPressed

    private void buscarApellidoFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_buscarApellidoFocusGained
        // TODO add your handling code here:
        buscarApellido.selectAll();
    }//GEN-LAST:event_buscarApellidoFocusGained

    private void buscarApellidoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_buscarApellidoKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_DOWN) {
            encontrados1.setSelectedIndex(0);
            encontrados1.requestFocusInWindow();
        } else if (evt.getKeyCode() == evt.VK_ESCAPE) {
            panelencontrados1.setVisible(false);
        } else {
            //      principal.tecla(evt.getKeyCode());
        }
    }//GEN-LAST:event_buscarApellidoKeyPressed

    private void buscarApellidoKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_buscarApellidoKeyReleased
        // TODO add your handling code here:
        if (!buscarApellido.getText().isEmpty()) {
            List lista = adm.query("Select o.idEstudiantes, o.apellidoPaterno, o.apellidoMaterno, o.nombre from Estudiantes as o "
                    + "where o.apellidoPaterno like '" + buscarApellido.getText() + "%' order by o.apellidoPaterno ", 0, 10);
            if (lista.size() > 0) {
                DefaultListModel dtm = new DefaultListModel();
                dtm.removeAllElements();
                encontrados1.setModel(dtm);
                int j = 0;
                for (Iterator it = lista.iterator(); it.hasNext();) {
                    Object[] elem = (Object[]) it.next();
                    Estudiantes est = new Estudiantes(elem[0] + "");
                    est.setApellidoPaterno(elem[1] + "");
                    est.setApellidoMaterno(elem[2] + "");
                    est.setNombre(elem[3] + "");
                    general gen = new general(est.getIdEstudiantes(), est.getApellidoPaterno() + " " + est.getApellidoMaterno() + " " + est.getNombre());
                    dtm.add(j, gen);
                }
                encontrados1.setModel(dtm);
                this.panelencontrados1.setVisible(true);
            } else {
                DefaultListModel dtm = new DefaultListModel();
                dtm.removeAllElements();
                encontrados1.setModel(dtm);
                this.panelencontrados1.setVisible(false);
            }

        } else {
            DefaultListModel dtm = new DefaultListModel();
            dtm.removeAllElements();
            encontrados1.setModel(dtm);
            this.panelencontrados1.setVisible(false);
        }
    }//GEN-LAST:event_buscarApellidoKeyReleased

    private void btnGuardarCerraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGuardarCerraActionPerformed
        // TODO add your handling code here:
        Parientes par = new Parientes(new Integer(codigoPariente.getText()));
        par.setIdentificacion(ruc1.getText());
        par.setNombres(nombre1.getText());
        par.setDireccion(direccion1.getText());
        par.setTelefonoTrabajo(telefono1.getText());
        par.setTipoRepresentante("F");
        adm.actualizar(par);
        adm.actualizar(par);
        ruc.setText(ruc1.getText());
        nombre.setText(nombre1.getText());
        direccion.setText(direccion1.getText());
        telefono.setText(telefono1.getText());


        frmActualizar.setVisible(false);
    }//GEN-LAST:event_btnGuardarCerraActionPerformed

    private void editarDatosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_editarDatosActionPerformed
        // TODO add your handling code here:

        frmActualizar.setVisible(true);
        ruc1.requestFocusInWindow();
    }//GEN-LAST:event_editarDatosActionPerformed

    private void ruc1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_ruc1KeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            nombre1.requestFocusInWindow();
        }
    }//GEN-LAST:event_ruc1KeyPressed

    private void nombre1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_nombre1KeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            direccion1.requestFocusInWindow();
        }
    }//GEN-LAST:event_nombre1KeyPressed

    private void direccion1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_direccion1KeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            telefono1.requestFocusInWindow();
        }
    }//GEN-LAST:event_direccion1KeyPressed

    private void telefono1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_telefono1KeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            btnGuardarCerra.requestFocusInWindow();
        }
    }//GEN-LAST:event_telefono1KeyPressed

    private void chkTodoMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_chkTodoMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_chkTodoMouseClicked

    private void chkTodoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkTodoActionPerformed
        // TODO add your handling code here:
        //general fac = (general) this.encontrados1.getSelectedValue();
        cargarRubros(EstudianteSeleccionado);
    }//GEN-LAST:event_chkTodoActionPerformed

    private void chkMatriculaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkMatriculaActionPerformed
        // TODO add your handling code here:
        cargarRubros(EstudianteSeleccionado);
    }//GEN-LAST:event_chkMatriculaActionPerformed

    private void chkCreditosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkCreditosActionPerformed
        // TODO add your handling code here:
        //general fac = (general) this.encontrados1.getSelectedValue();
        cargarRubros(EstudianteSeleccionado);
    }//GEN-LAST:event_chkCreditosActionPerformed

    private void chkNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkNuevoActionPerformed
        // TODO add your handling code here:
        
        cargarRubros(EstudianteSeleccionado);
    }//GEN-LAST:event_chkNuevoActionPerformed

    private void chkAntiguoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkAntiguoActionPerformed
        // TODO add your handling code here:
         
        cargarRubros(EstudianteSeleccionado);
    }//GEN-LAST:event_chkAntiguoActionPerformed

    private void tipoAItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_tipoAItemStateChanged
        // TODO add your handling code here:
        if (tipoA.getSelectedIndex() > 0) {
            if (tipoA.getSelectedItem().toString().contains("Efec") || tipoA.getSelectedItem().toString().contains("Desc")) {
                valorA.setEnabled(true);
                if (tipoA.getSelectedItem().toString().contains("Desc")) {
                    referenciaA.setEnabled(true);
                }
                anadir.setEnabled(true);

                valorA.requestFocusInWindow();
                valorA.selectAll();
            } else {
                valorA.setEnabled(true);
                referenciaA.setEnabled(true);
                bancoA.setEnabled(true);
                fechaA.setEnabled(true);
                anadir.setEnabled(true);
                if (!tipoA.getSelectedItem().toString().contains("Tarje")) {
                    confirmadoA.setEnabled(true);
                }
                valorA.requestFocusInWindow();
                valorA.selectAll();
            }
        }
    }//GEN-LAST:event_tipoAItemStateChanged

    private void valorAKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_valorAKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            if (tipoA.getSelectedItem().toString().contains("Efe")) {
                anadir.requestFocusInWindow();
            } else if (tipoA.getSelectedItem().toString().contains("Desc")) {
                referenciaA.requestFocusInWindow();
            } else {
                bancoA.requestFocusInWindow();
            }
        }
    }//GEN-LAST:event_valorAKeyPressed

    private void fechaAKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_fechaAKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            if (tipoA.getSelectedItem().toString().contains("Tarj")) {
                anadir.requestFocusInWindow();
            } else {
                confirmadoA.requestFocusInWindow();
            }
        }
    }//GEN-LAST:event_fechaAKeyPressed
    private void sumarPagos() {

        int filas = formasdePago.getRowCount();
        Double totalCalc = 0.0;
        Double descuentos = 0.0;
        for (int i = 0; i < filas; i++) {
            if (formasdePago.getValueAt(i, 0).toString().contains("Desc")) {
                descuentos += ((Double) formasdePago.getValueAt(i, 1));
            } else {
                totalCalc += ((Double) formasdePago.getValueAt(i, 1));;
            }
        }
        descuento2.setText(descuentos + "");
        totalCobros.setText("" + totalCalc);
    }

    private void anadirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_anadirActionPerformed
        // TODO add your handling code here:

        DefaultTableModel dtm = (DefaultTableModel) formasdePago.getModel();
        //dtm.getDataVector().removeAllElements();
        if (valorA.getText().isEmpty()) {
            valorA.requestFocusInWindow();
            valorA.selectAll();
            return;
        }
        if (new Double(valorA.getText()) <= 0.0) {
            valorA.requestFocusInWindow();
            valorA.selectAll();
            return;
        }
        if (!tipoA.getSelectedItem().toString().contains("Efe")) {

            if (referenciaA.getText().isEmpty()) {
                referenciaA.requestFocusInWindow();
                referenciaA.selectAll();
                return;
            }
            if (!tipoA.getSelectedItem().toString().contains("Desc")) {
                if (bancoA.getSelectedIndex() == 0) {
                    bancoA.requestFocus(true);
                    bancoA.requestFocusInWindow();
                    return;
                }
                if (fechaA.getDate() == null) {
                    fechaA.requestFocus(true);
                    fechaA.requestFocusInWindow();
                    return;
                }
            }
        }


        Object[] obj = new Object[10];
        obj[0] = tipoA.getSelectedItem().toString();
        obj[1] = new Double(valorA.getText());
        obj[2] = (bancoA.getSelectedIndex()>0?bancoA.getSelectedItem():null);
        obj[3] = referenciaA.getText();
        obj[4] = fechaA.getDate();
        obj[5] = confirmadoA.isSelected();
        dtm.addRow(obj);
        formasdePago.setModel(dtm);

        valorA.setEnabled(false);
        referenciaA.setEnabled(false);
        anadir.setEnabled(false);
        bancoA.setEnabled(false);
        fechaA.setEnabled(false);
        confirmadoA.setEnabled(false);

        valorA.setText("0.00");
        referenciaA.setText("");
        anadir.setEnabled(false);
        bancoA.setSelectedIndex(0);
        fechaA.setDate(new Date());
        confirmadoA.setEnabled(false);
        tipoA.setSelectedIndex(0);
        tipoA.requestFocusInWindow();
        sumarPagos();
    }//GEN-LAST:event_anadirActionPerformed

    private void bancoAKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_bancoAKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {

            referenciaA.requestFocusInWindow();

        }
    }//GEN-LAST:event_bancoAKeyPressed

    private void referenciaAKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_referenciaAKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_ENTER) {
            if (tipoA.getSelectedItem().toString().contains("Desc")) {
                anadir.requestFocusInWindow();
            } else {
                fechaA.requestFocusInWindow();
                fechaA.requestFocus();
            }
        }
    }//GEN-LAST:event_referenciaAKeyPressed

    private void formasdePagoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_formasdePagoKeyPressed
        // TODO add your handling code here:
        if (evt.getKeyCode() == evt.VK_DELETE) {
            int fil = formasdePago.getSelectedRow();
            DefaultTableModel dtm = (DefaultTableModel) formasdePago.getModel();
            dtm.removeRow(fil);
            formasdePago.setModel(dtm);
            this.sumarPagos();
            this.sumar();
        }
    }//GEN-LAST:event_formasdePagoKeyPressed

    private void facturaFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_facturaFocusGained
        // TODO add your handling code here:
          factura.selectAll();
    }//GEN-LAST:event_facturaFocusGained

    private void facturaFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_facturaFocusLost
        // TODO add your handling code here:
    String codigo = factura.getText() + "";
    while (codigo.length() < 7) {
        codigo = "0" + codigo;
    }
    factura.setText("" + codigo);

    String abuscar = "" + inst.getSerie1() + "" + factura.getText();
    Facturas cabe = (Facturas) adm.buscarClave(abuscar, Facturas.class);
    if (cabe != null) {
        JOptionPane.showMessageDialog(this, "NÚMERO DE FACTURA YA EXISTE, CAMBIE DE NÚMERO...!");
        factura.setText("");
        factura.requestFocusInWindow();
    }
        
    }//GEN-LAST:event_facturaFocusLost

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton anadir;
    private javax.swing.JComboBox bancoA;
    private javax.swing.JButton btnEliminar;
    private javax.swing.JButton btnGuardarCerra;
    private javax.swing.JButton btnModificar;
    private javax.swing.JButton btnNuevo;
    private javax.swing.JButton btnSalir;
    private javax.swing.JFormattedTextField buscarApellido;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.ButtonGroup buttonGroup2;
    private javax.swing.JLabel carrera;
    private javax.swing.JLabel categoriaSocial;
    private javax.swing.JRadioButton chkAntiguo;
    private javax.swing.JRadioButton chkCreditos;
    private javax.swing.JRadioButton chkMatricula;
    private javax.swing.JRadioButton chkNuevo;
    private javax.swing.JRadioButton chkTodo;
    private javax.swing.JFormattedTextField codigoPariente;
    private javax.swing.JCheckBox confirmadoA;
    private javax.swing.JLabel descuento;
    private javax.swing.JLabel descuento2;
    private javax.swing.JLabel direccion;
    private javax.swing.JFormattedTextField direccion1;
    private javax.swing.JButton editarDatos;
    private javax.swing.JList encontrados1;
    private javax.swing.JFormattedTextField factura;
    private com.toedter.calendar.JDateChooser fechaA;
    private javax.swing.JTable formasdePago;
    private javax.swing.JPanel frmActualizar;
    private javax.swing.JLabel iva;
    private com.toedter.calendar.JDateChooser jDateChooser1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane8;
    private javax.swing.JLabel nombre;
    private javax.swing.JFormattedTextField nombre1;
    private javax.swing.JPanel panelencontrados1;
    private javax.swing.JFormattedTextField referenciaA;
    private javax.swing.JLabel ruc;
    private javax.swing.JFormattedTextField ruc1;
    private javax.swing.JLabel subtotal;
    private javax.swing.JTable tFactura;
    private javax.swing.JLabel telefono;
    private javax.swing.JFormattedTextField telefono1;
    private javax.swing.JComboBox tipoA;
    private javax.swing.JLabel total;
    private javax.swing.JLabel total1;
    private javax.swing.JLabel total10;
    private javax.swing.JLabel total11;
    private javax.swing.JLabel total12;
    private javax.swing.JLabel total13;
    private javax.swing.JLabel total14;
    private javax.swing.JLabel total3;
    private javax.swing.JLabel total4;
    private javax.swing.JLabel total5;
    private javax.swing.JLabel total6;
    private javax.swing.JLabel total7;
    private javax.swing.JLabel total8;
    private javax.swing.JLabel total9;
    private javax.swing.JLabel totalCobros;
    private javax.swing.JFormattedTextField valorA;
    // End of variables declaration//GEN-END:variables

    public Periodos getPeriodoActual() {
        return periodoActual;
    }

    public void setPeriodoActual(Periodos periodoActual) {
        this.periodoActual = periodoActual;
    }

    public Empleados getEmpleadoActual() {
        return empleadoActual;
    }

    public void setEmpleadoActual(Empleados empleadoActual) {
        this.empleadoActual = empleadoActual;
    }
}
