<?xml version="1.0" encoding="utf-8"?>
<?page title="Administrador Educativo"?>
<?page id="matriculapage"?>
 

<window id="principales" onCreate="llenar()" >
    <style>
        .MyGridRowHeight tr.z-row td.z-row-inner  
        {
        background: white;
        border-top: none;
        border-left: 1px solid white;
        border-right: 1px solid #CCC;
        border-bottom: 1px solid #DDD;
 
        }
        /*.MyGridRowHeight tr.z-grid-odd td.z-row-inner, tr.z-grid-odd{
        background: #F8F8F8;
        } */
        .MyGridRowHeight td.z-row-inner
        {
            padding: 0px 0px 0px 0px ;
            //overflow: hidden;
        }
    </style>
    <zscript>
            <![CDATA[
  import jcinform.persistencia.Global;
  import bean.EventDAO;
  import java.util.ArrayList;
  import jcinform.persistencia.*;
  import jcinform.procesos.Administrador;
  import bean.Permisos;
  import java.io.FileNotFoundException;
  import java.io.FileOutputStream;
import java.io.DataOutputStream;
import java.io.FileInputStream;
    import java.io.InputStream;
  import java.io.IOException;
  import java.util.logging.Level;
  import java.util.logging.Logger;
import java.util.Vector;
import bean.matriculasBean;
import sources.CustomDataSource;
import net.sf.jasperreports.engine.JRDataSource;
import sources.*;
import bean.notas;
import java.math.BigDecimal;
import bean.notas;
import jcinform.persistencia.*;
import jcinform.procesos.Administrador;
import miniaturas.*;
import java.util.Date;
import org.joda.time.DateMidnight;
import org.zkoss.zul.Listbox;

CrearMiniaturas mini = new CrearMiniaturas();
Boolean cargandoFoto = false;
Boolean guardando = false;
    Administrador adm = new Administrador();
    List allEvents = adm.query("Select o from Estudiantes as o where o.cedula = 0");
    static Estudiantes estudent = new Estudiantes();
    static Representante representante0 = new Representante();
    static Matriculas matricula = new Matriculas();
 Session ses = Sessions.getCurrent();
 Periodo periodo = (Periodo) ses.getAttribute("periodo");
 Permisos permiso = new Permisos();
Empleados user =  (Empleados)ses.getAttribute("user");


List cursos = adm.query("Select o.curso from EmpleadoCurso as o " +
      " where o.profesor.codigoemp = '"+ user.getCodigoemp() +"' and o.curso.periodo.codigoper = '"+ periodo.getCodigoper() +"' order by o.curso.secuencia, o.curso.paralelo.descripcion ");
System.out.println("NUMERO DE CURSOS: "+cursos);

   if(cursos.size()<=0){
             cursos = adm.query("Select o from Cursos as o "
            + " where o.periodo.codigoper = '"+ periodo.getCodigoper() +"'  ");
            System.out.println("ENTRO VACIO");
   }
    Object media = null;


        //FUNCIONES
        void cargarFoto(byte[] imageData){
          foto0.setContent(new org.zkoss.image.AImage("fotito", imageData));
        }
        void cargarVacio(){
          foto0.setContent(new org.zkoss.image.AImage("vacio", desktop.webApp.getResourceAsStream("/fotos/vacio.gif")));
        }
       Integer nuevaMatricula() {
       Administrador adm = new Administrador();

        List NoActualMatricula = adm.query("Select o from ParametrosGlobales as o " +
                "where o.variable = 'MATRICULA' and o.periodo.codigoper = '" + periodo.getCodigoper() + "'");
        ParametrosGlobales parametros = new ParametrosGlobales();
        if(NoActualMatricula.size()<=0){
            alert("Falta copiar los parámetros a este Año Lectivo");
        }
        parametros = (ParametrosGlobales) NoActualMatricula.get(0);
        int noMatri = 0;
        Double decs = parametros.getNvalor();
        Long val = java.lang.Math.round(decs);
        noMatri = Integer.valueOf(val.toString());
        noMatri += 1;
        List  numeroYa = adm.query("Select o from Matriculas as o " +
                "where o.curso.periodo.codigoper = '" + periodo.getCodigoper() + "' " +
                "and o.numero = '" + noMatri + "'");
        if (numeroYa.size() > 0) {
            Integer nClave = adm.geUltimaMatricula("Select max(o.numero) from Matriculas as o " +
                    "where o.curso.periodo.codigoper= '" + periodo.getCodigoper() + "'"  );
            parametros.setNvalor(new Double(nClave + 1));
            adm.actualizar(parametros);
            return nClave + 1;
        } else {
            parametros.setNvalor(new Double(noMatri));
            adm.actualizar(parametros);
            return noMatri;
        }
    }

    void generarClave(Boolean boton){
    try{
    String uss = usuario.value;
    if(boton==false){
        if(uss.trim() != ""){
                return;
        }
    }
        String user ="";
        String caracter="";
        caracter+="JCQWERTYUIOPASDFGHJKLZXCVBNM";
        String caracterNumeros="09876543210987654321098765432109876543210987654321";
        int numero_caracteres=5;
        int total=caracter.length();
        String  clave2="";
        for(int a=0;a<numero_caracteres;a++){
            clave2+=caracterNumeros.charAt(((Double)(total*Math.random())).intValue());
        }

            clave.value = clave2.toUpperCase();
             caracter=""+apellidos.value.trim().replace(" ","");
            caracter+="JC"+nombres.value.trim().replace(" ","");
            numero_caracteres=5;
            total=caracter.length();
            caracter = caracter.replace("Ñ", "").replace("Á", "").replace("É", "").replace("Í", "").replace("Ó", "").replace("Ú", "").replace("-", "");
            user ="";
            for(int a=0;a<numero_caracteres;a++){
                user+=caracter.charAt(((Double)(total*Math.random())).intValue());
            }
            usuario.value = user.toUpperCase();
            }catch(Exception e){
            System.out.println("ERROR EN GENERAR CLAVE"+e);
            }
    }
       void generarClaveRep(Boolean boton){
    try{
    String uss = usuarior.value;
    if(boton==false){
        if(uss.trim() != ""){
                return;
        }
    }
        String user ="";
        String caracter="";
        String caracterNumeros="0987654321098765432109876543210987654321";
        caracter+="JCQWERTYUIOPASDFGHJKLZXCVBNM";
        int numero_caracteres=5;
        int total=caracter.length();
        String  clave2="";
        for(int a=0;a<numero_caracteres;a++){
            clave2+=caracterNumeros.charAt(((Double)(total*Math.random())).intValue());
        }

            claver.value = clave2.toUpperCase();
             caracter=""+apellidosre.value.trim().replace(" ","");
            caracter+="JC"+nombresre.value.trim().replace(" ","");
            numero_caracteres=6;
            total=caracter.length();
            user ="";
            caracter = caracter.replace("Ñ", "").replace("Á", "").replace("É", "").replace("Í", "").replace("Ó", "").replace("Ú", "").replace("-", "");
            for(int a=0;a<numero_caracteres;a++){
                user+=caracter.charAt(((Double)(total*Math.random())).intValue());
            }
            usuarior.value = user.toUpperCase();
            }catch(Exception e){
            System.out.println("ERROR EN GENERAR CLAVE"+e);
            }
    }

void llenar(Estudiantes estudent){
    codigo.value = estudent.getCodigoest();
    cedula.value = estudent.getCedula();
    nombres.value = estudent.getNombre();
    apellidos.value = estudent.getApellido();
    direccion.value = estudent.getDireccion();
    barrio.value = estudent.getBarrio();
    telefono.value = estudent.getTelefono();
    genero.value = estudent.getGenero();
    religion.value = estudent.getReligion();
    nacido.value = estudent.getFechanacimiento();
    mail.value = estudent.getMail();
    usuario.value = estudent.getUsuario();
    nobus.value = estudent.getNobus();
    aseguradora.value = estudent.getAseguradora();
            provincia.value = estudent.getProvincia();
            canton.value = estudent.getCanton();
            lugarnacimiento.value = estudent.getLugarnacimiento();
            nacionalidad.value = estudent.getNacionalidad();
            hermanos.value = estudent.getHermanos();
            lugar.value = estudent.getLugar();
            vivecon.value   = estudent.getVivecon();
            try{
                    ingpadre.value = estudent.getIngpadre().intValue();
                    ingmadre.value = estudent.getIngmadre().intValue();
                    ingotros.value = estudent.getIngotros().intValue();
            }catch(Exception cero){
                    ingpadre.value = 0;
                    ingmadre.value = 0;
                    ingotros.value = 0;

            }
            


            if(estudent.getLuz()!=null){
                luz.checked = estudent.getLuz();
            }
            if(estudent.getAgua()!=null){
                agua.checked = estudent.getAgua();
            }
            if(estudent.getSshh()!=null){
                sshh.checked = estudent.getSshh();
            }
            if(estudent.getPozo()!=null){
                pozo.checked = estudent.getPozo();
            }
            if(estudent.getTelefonob()!=null){
                telefonob.checked = estudent.getTelefonob();
            }
            if(estudent.getInternet()!=null){
                internet.checked = estudent.getInternet();
            }
            if(estudent.getMatriculado()!=null){
                matriculado.checked = estudent.getMatriculado();
            }
             if(estudent.getEstado()!=null){
                estadoe.checked= estudent.getEstado();
            }
            if(estudent.getAdventista()!=null){

                adventista.checked = estudent.getAdventista();
            }
            if(estudent.getTransporte()!=null){
                transporte.checked = estudent.getTransporte();
            }
            if(estudent.getAsegurado()!=null){
                asegurado.checked = estudent.getAsegurado();
            }
              if(estudent.getPendientes()!=null){
                pendientes.checked = estudent.getPendientes();
            }
            if(estudent.getAplico()!=null){
                aplico.checked = estudent.getAplico();
            }
            String tCasa = estudent.getCasa();
               codigoclave.value = estudent.getCodigo();
                  llenarCasa(tCasa);
             tCasa = estudent.getEstadocivil();
            llenarCivil(tCasa);
           //casa.setSelectedItem(r);
          
          


    clave.value = permiso.decriptar(estudent.getClave());
           


        if(estudent.getRepresentante()==null){
            Representante re = new Representante(0);
            re.setTipoidentificacion("C");
            estudent.setRepresentante(re);
        }
        llenarRepresentante(estudent.getRepresentante());

List matricula = adm.query("Select o from Matriculas as o where o.estudiante.codigoest = '"+estudent.getCodigoest()+"' "
+ " and o.curso.periodo.codigoper = '"+periodo.getCodigoper()+"'  ");
    if(matricula.size()>0)
    {
        llenarMatricula(matricula.get(0));
        /* modificar.disabled = true;
        for(Iterator it = cursos.iterator(); it.hasNext();){
            Cursos cur = it.next();
            if(cur.getCodigocur().equals(matricula.get(0).getCurso().getCodigocur()))
                modificar.disabled = false;
        }
        */
        
    }else{
        llenarMatricula(new Matriculas(0));
        numero.value = 0;
//        Messagebox.show("No se encuentra Inscrito ni Matriculado...!", "Administrador Educativo", Messagebox.OK, Messagebox.EXCLAMATION);
    }
}

void llenarCasa(String tCasa){
    List l = casa.getChildren();
    Boolean estado = false;
            for (Iterator it = l.iterator(); it.hasNext();) {
               Radio object = (Radio)it.next();
               if(object.getLabel().equals(tCasa)){
                   object.setSelected(true);
                   estado = true;
                   break;
               }  

           }
           if(estado == false){
                Radio object = (Radio)l.get(0);
                   object.setSelected(true);
           }

}

void llenarCivil(String tCasa){
    List l = estadocivil.getChildren();
    Boolean estado = false;
            for (Iterator it = l.iterator(); it.hasNext();) {
               Radio object = (Radio)it.next();
               if(object.getLabel().equals(tCasa)){
                   object.setSelected(true);
                   estado = true;
                   break;
               }  

           }
           if(estado == false){
                Radio object = (Radio)l.get(0);
                   object.setSelected(true);
           }


}

void llenarMatricula(Matriculas matri){
         
         codigomat.value =matri.getCodigomat();
         accion.value = matri.getEstado();
         fechamatricula.value =matri.getFechamat();

         fecharetiro.value = matri.getFecharet();
         
         numero.value = matri.getNumero();
         folio.value = matri.getFolio();
         institucion.value = matri.getInstitucion();
            if(matri.getPerdio()!=null){
                perdio.checked = matri.getPerdio();
            }
            if(matri.getSuspenso()!=null){
                suspenso.checked = matri.getSuspenso();
            }
         
            if(matri.getNuevo()!=null){
                nuevo.checked = matri.getNuevo();
            }
            if(matri.getRepite()!=null){
                repite.setSelectedIndex(matri.getRepite());
         
            }

         try{
            beca.value = new BigDecimal(matri.getBeca());
            otros.value = new BigDecimal(matri.getOtros());
         }catch(Exception e){}
         observacion.value = matri.getObservacion();
         
            if(matri.getCurso() != null){
             try{
                      for (int i = 0; i <= curso.getItems().size(); i++) {
                                    Cursos tr0 = ((Cursos)((Listitem)curso.getItems().get(i)).getValue());
                                    int primero = tr0.getCodigocur();
                                    int segundo = matri.getCurso().getCodigocur();
                                    if(primero == segundo){
                                        curso.setSelectedItem((Listitem)curso.getItems().get(i));
                                        bd1.value = matri.getCurso().getDescripcion()+" "+ matri.getCurso().getEspecialidad()+" "+ matri.getCurso().getParalelo();
                                        break;
                                    }
                           }
                 }catch(Exception err){System.out.println("ERROR no tiene cursos asignados COMBO CURSOS: "+err);}


            }
            if(cargandoFoto == false){
                FileInputStream fin = null;
                if(matri.getExtension()!= null){
                    try {

                        java.io.File f = new java.io.File(periodo.getInstitucion().getFotos()+matri.getCodigomat()+"."+matri.getExtension());
                        fin = new FileInputStream(f);
                        byte[] buffer = new byte[(int) f.length()];
                        fin.read(buffer);
                        fin.close();
                        foto0.setContent(new org.zkoss.image.AImage("fotito", buffer));
                        foto0.visible = true;
                    } catch (FileNotFoundException ex) {
                    cargarVacio();
                        Logger.getLogger("ERROR EN MATRICULAS: ").log(Level.SEVERE, null, ex);
                    }
           }else{
                cargarVacio();
           }
        } 
}

void copiarpr(){
     cedulare.value = cedulapa.value;
     nombresre.value = nombrespa.value ;
     apellidosre.value = apellidospa.value;
     telefonore.value = telefonopa.value;
     direccionre.value = direccionpa.value;
}

void copiarmr(){
     cedulare.value = cedulama.value;
     nombresre.value = nombresma.value ;
     apellidosre.value = apellidosma.value;
     telefonore.value = telefonoma.value;
     direccionre.value = direccionma.value;
}


void copiarp(){
     cedulafac.value = cedulapa.value;
     nombresfac.value = apellidospa.value + " "+ nombrespa.value ;
     telefonofac.value = telefonopa.value;
     direccionfac.value = direccionpa.value;
}

void copiarm(){
     cedulafac.value = cedulama.value;
     nombresfac.value = apellidosma.value + " "+ nombresma.value ;
     telefonofac.value = telefonoma.value;
     direccionfac.value = direccionma.value;
}

void copiarr(){
     cedulafac.value = cedulare.value;
     nombresfac.value = apellidosre.value + " "+ nombresre.value ;
     telefonofac.value = telefonore.value;
     direccionfac.value = direccionre.value;
}

void llenarRepresentante(Representante repren){
    codigore.value = repren.getCodigorep();
    cedulare.value = repren.getIdentificacionrepre();
    nombresre.value = repren.getNombres();
    apellidosre.value = repren.getApellidos();
    direccionre.value = repren.getDireccion();
    telefonore.value = repren.getTelefono();
    emailre.value = repren.getEmail();

     Listitem item = new Listitem();
     String tip = repren.getTipoidentificacion();
     item.setValue(tip);
     try{
     item.appendChild(new Listcell( (tip.equals("C")?"CEDULA":"RUC") +""));
     }catch(Exception e){
            item.appendChild(new Listcell("CEDULA"));
     }
     tipofac.appendChild(item);
     tipofac.setSelectedItem(item);
     llenarConsumidor();
     cedulafac.value = repren.getIdentificacionfactura();
     nombresfac.value = repren.getNombrefactura();
     telefonofac.value = repren.getTelfactura();
     direccionfac.value = repren.getDirfactura();



    cedulapa.value = repren.getIdentificacionpadre();
    nombrespa.value = repren.getNompadre();
    apellidospa.value = repren.getApepadre();
    direccionpa.value = repren.getDirpadre();
    telefonopa.value = repren.getTelpadre();
    emailpa.value = repren.getMailpadre();
    parentesco.value = repren.getParentesco();
    ocupacionpa.value = repren.getOcupacionpadre();
    profesionpa.value = repren.getProfesionpadre();
    cedulama.value = repren.getIdentificacionmadre();
    nombresma.value = repren.getNommadre();
    apellidosma.value = repren.getApemadre();
    direccionma.value = repren.getDirmadre();
    telefonoma.value = repren.getTelmadre();
    emailma.value = repren.getMailmadre();
    ocupacionma.value = repren.getOcupacionmadre();
    profesionma.value = repren.getProfesionmadre();
    usuarior.value = repren.getUsuario();
    claver.value = permiso.decriptar(repren.getClave());


}
void estado(Boolean estado,Boolean modificar){
        if(modificar){
            estudent = (Estudiantes)datos.selectedItem.value;
        }
   padrec.disabled = estado;
   madrec.disabled = estado;
   padrecr.disabled = estado;
   madrecr.disabled = estado;
   subirb.disabled = estado;
   nuevoE.disabled = estado;
   limpiar.disabled = estado;
   representantec.disabled = estado;
   codigo.readonly = estado;
    cedula.readonly = estado;
    nombres.readonly = estado;
    apellidos.readonly = estado;
    direccion.readonly = estado;
    barrio.readonly = estado;
    telefono.readonly = estado;
    genero.readonly = estado;
    religion.readonly = estado;
    mail.readonly = estado;
    nacido.readonly = estado;
    tratamiento.readonly = estado;
    usuario.readonly = estado;
    clave.readonly = estado;
    usuarior.readonly = estado;
    claver.readonly = estado;
    beca.readonly = estado;
    otros.readonly = estado;
    tipo.readonly= estado;
    estadoe.disabled= estado;
    perf.readonly = estado;
    bd.readonly = estado;

    codigomat.readonly = estado;
    //numero.readonly = estado;
    folio.readonly = estado;
    curso.disabled = estado;
    //accion.readonly = estado;
    fechamatricula.readonly = estado;
    fecharetiro.readonly = estado;
    observacion.readonly= estado;
    adventista.disabled= estado;
    nuevo.disabled = estado;
    transporte.disabled = estado;
    asegurado.disabled = estado;
    aseguradora.readonly = estado;
    //repite.disabled = estado;
    nobus.readonly = estado;
    cedulare.readonly = estado;
    nombresre.readonly = estado;
    apellidosre.readonly = estado;
    direccionre.readonly = estado;
    telefonore.readonly = estado;
    emailre.readonly = estado;
    institucion.readonly = estado;

    tipofac.disabled = estado;
    cedulafac.readonly = estado;
    nombresfac.readonly = estado;
    direccionfac.readonly = estado;
    telefonofac.readonly = estado;



   cedulapa.readonly = estado;
    nombrespa.readonly = estado;
    apellidospa.readonly = estado;
    direccionpa.readonly = estado;
    telefonopa.readonly = estado;
    emailpa.readonly = estado;
    parentesco.readonly = estado;
    ocupacionpa.readonly = estado;
    profesionpa.readonly = estado;

   cedulama.readonly = estado;
    nombresma.readonly = estado;
    apellidosma.readonly = estado;
    direccionma.readonly = estado;
    telefonoma.readonly = estado;
    emailma.readonly = estado;
    ocupacionma.readonly = estado;
    profesionma.readonly = estado;
    
    
    cod1.readonly = estado; nom1.readonly = estado; par1.readonly = estado; cel1.readonly = estado; con1.value="";
        cod2.readonly = estado;nom2.readonly = estado; par2.readonly = estado; cel2.readonly = estado; con2.readonly = estado;
        cod3.readonly = estado;nom3.readonly = estado; par3.readonly = estado; cel3.readonly = estado; con3.readonly = estado;

        cod11.readonly = estado; nom11.readonly = estado; par11.readonly = estado; ci11.readonly = estado;
        cod22.readonly = estado; nom22.readonly = estado; par22.readonly = estado; ci22.readonly = estado;
        cod33.readonly = estado; nom33.readonly = estado; par33.readonly = estado; ci33.readonly = estado ;

        codh1.readonly = estado; codh2.readonly = estado; codh3.readonly = estado; 
        nomh1.readonly = estado;nomh2.readonly = estado;nomh3.readonly = estado;
        anioh1.readonly = estado;  anioh2.readonly = estado; anioh3.readonly = estado; 


}


 void guardar(){
 if(guardando)
        return;
 guardando = true;
 try{
            if(nombres.value=="" || apellidos.value =="" || direccion.value=="" || nacido.value=="" ){
                    Messagebox.show("Ingrese los datos del estudiante que están con (*)...!", "Administrador Educativo", Messagebox.OK, Messagebox.EXCLAMATION);
                    guardando = false;
                    return;
            }
            if(nombresre.value=="" || apellidosre.value =="" || direccionre.value=="" ){
                    Messagebox.show("Ingrese los datos del representante que estan con (*)...!", "Administrador Educativo", Messagebox.OK, Messagebox.EXCLAMATION);
                    guardando = false;
                    return;
            }

        representante0.setCodigorep(codigore.value);
        representante0.setIdentificacionrepre(cedulare.value);
        representante0.setNombres(nombresre.value);
        representante0.setApellidos(apellidosre.value);
        representante0.setDireccion(direccionre.value);
        representante0.setTelefono(telefonore.value);
        representante0.setEmail(emailre.value);

        representante0.setTipoidentificacion(tipofac.selectedItem.value);
        representante0.setIdentificacionfactura(cedulafac.value);
        representante0.setNombrefactura(nombresfac.value);
        representante0.setDirfactura(direccionfac.value);
        representante0.setTelfactura(telefonofac.value);

        representante0.setIdentificacionpadre(cedulapa.value);
        representante0.setApepadre(apellidospa.value);
        representante0.setNompadre(nombrespa.value);
        representante0.setTelpadre(telefonopa.value);
        representante0.setDirpadre(direccionpa.value);
        representante0.setMailpadre(emailpa.value);
        representante0.setParentesco(parentesco.value);
        representante0.setProfesionpadre(profesionpa.value);
        representante0.setOcupacionpadre(ocupacionpa.value);

        representante0.setIdentificacionmadre(cedulama.value);
        representante0.setApemadre(apellidosma.value);
        representante0.setNommadre(nombresma.value);
        representante0.setTelmadre(telefonoma.value);
        representante0.setDirmadre(direccionma.value);
        representante0.setMailmadre(emailma.value);
        representante0.setProfesionmadre(profesionma.value);
        representante0.setOcupacionmadre(ocupacionma.value);
        representante0.setUsuario(usuarior.value);
        representante0.setClave(permiso.encriptar(claver.value));
        representante0.setEstado(pendientes.checked);
 
         Boolean repreNuevo = false;
         Boolean estuNuevo = false;

         if((!representante0.getCodigorep().equals(0))){
             adm.actualizar(representante0);
         }else{
            representante0.setCodigorep(adm.getNuevaClave("Representante","codigorep"));
            adm.guardar(representante0);
            repreNuevo = true;
         }


 //GUARDO EL ESTUDIANTE
        estudent.setRepresentante(representante0);
        estudent.setCodigoest(codigo.value);
        estudent.setCedula(""+cedula.value);
        estudent.setNombre(nombres.value);
        estudent.setApellido(apellidos.value);
        estudent.setDireccion(direccion.value);
        estudent.setBarrio(barrio.value);
        estudent.setTelefono(telefono.value);
        estudent.setMail(mail.value);
        estudent.setFechanacimiento(nacido.value);
        estudent.setEstado(true);
        estudent.setAdventista(adventista.checked);
        estudent.setTransporte(transporte.checked);
        estudent.setNobus(nobus.value);
        estudent.setAseguradora(aseguradora.value);
        estudent.setUsuario(usuario.value);
        estudent.setClave(permiso.encriptar(clave.value));
        estudent.setGenero(genero.selectedItem.value);
        try{

            estudent.setReligion(religion.selectedItem.value);
        }catch(Exception error){
            estudent.setReligion("Ninguno");
        }

        estudent.setPendientes(pendientes.checked);

        estudent.setVivecon(vivecon.value);
        estudent.setHermanos(hermanos.value);
        estudent.setLugar(lugar.value);
        estudent.setLugarnacimiento(lugarnacimiento.value);
        estudent.setProvincia(provincia.value);
        estudent.setCanton(canton.value);
        estudent.setNacionalidad(nacionalidad.value);
        estudent.setDiscapacidad(discapacidad.checked);
        estudent.setTipodiscapacidad(tipodiscapacidad.value);
        estudent.setIngpadre(new Double(ingpadre.value));
        estudent.setIngmadre(new Double(ingmadre.value));
        estudent.setIngotros(new Double(ingotros.value));
        estudent.setCasa(casa.getSelectedItem().getLabel());
        estudent.setEstadocivil(estadocivil.getSelectedItem().getLabel());
        estudent.setAgua(agua.checked);
        estudent.setLuz(luz.checked);
        estudent.setSshh(sshh.checked);
        estudent.setPozo(pozo.checked);
        estudent.setTelefonob(telefonob.checked);
        estudent.setInternet(internet.checked);
        estudent.setCodigo(codigoclave.value);
        estudent.setMatriculado(matriculado.checked);
        estudent.setAplico(aplico.checked);
            


        if((!estudent.getCodigoest().equals(0))){
             adm.actualizar(estudent);
             try{
                List children = datos.selectedItem.children;
                  ((Listcell)children.get(0)).label = cedula.value;
                  ((Listcell)children.get(1)).label = apellidos.value + " " + nombres.value;
                  ((Listcell)children.get(2)).label = direccion.value;
                  }catch(Exception e){}
         }else{
            estudent.setCodigoest(adm.getNuevaClave("Estudiantes","codigoest"));
            adm.guardar(estudent);
            estuNuevo = true;
         }
         
         
 //GUARDO HERMANOS
 //BORRAR LOS HERMANOS Y CARGAR NUEVAMENTE
     String sqls = "Delete from Hermanos "+ 
                " where estudiante.codigoest = '"+ estudent.getCodigoest() +"'  ";
                System.out.println(sqls);
                    adm.ejecutaSql(sqls);
        if(!(codh1.value).equals(0)){
                Hermanos her = new Hermanos(adm.getNuevaClave("Hermanos","codigo"));
                her.setHermanos(new Estudiantes(codh1.value));
                her.setCurso(anioh1.value);
                her.setEstudiante(estudent);
                if(nomh1.value!="" && nomh1.value != null){
                    if(nomh1.value.length()>5)
                        adm.guardar(her);
                }
         }
         if(!(codh2.value).equals(0)){
                Hermanos her = new Hermanos(adm.getNuevaClave("Hermanos","codigo"));
                her.setHermanos(new Estudiantes(codh2.value));
                her.setCurso(anioh2.value);
                her.setEstudiante(estudent);
                if(nomh2.value!="" && nomh2.value != null){
                    if(nomh2.value.length()>5)
                        adm.guardar(her);
                }
         }
         if(!(codh3.value).equals(0)){
                Hermanos her = new Hermanos(adm.getNuevaClave("Hermanos","codigo"));
                her.setHermanos(new Estudiantes(codh3.value));
                her.setCurso(anioh3.value);
                her.setEstudiante(estudent);
                if(nomh3.value!="" && nomh3.value != null){
                    if(nomh3.value.length()>5)
                        adm.guardar(her);
                }
         }
                                                     
 
 //GUARDO RETIRAN O EMERGENCIAS
 if(!(cod11.value).equals(0)){
                Retiran ret = new Retiran(cod11.value);
                ret.setApellidos(nom11.value);
                ret.setParentesco(par11.value);
                ret.setCedula(ci11.value);
                ret.setTipo("R");
                ret.setEstudiante(estudent);
                adm.actualizar(ret);
         }else{
                Retiran ret = new Retiran(adm.getNuevaClave("Retiran","codigo"));
                ret.setApellidos(nom11.value);
                ret.setParentesco(par11.value);
                ret.setCedula(ci11.value);
                ret.setTipo("R");
                ret.setEstudiante(estudent);
                adm.guardar(ret);
         }
         
         if(!(cod22.value).equals(0)){
                Retiran ret = new Retiran(cod22.value);
                ret.setApellidos(nom22.value);
                ret.setParentesco(par22.value);
                ret.setCedula(ci22.value);
                ret.setTipo("R");
                ret.setEstudiante(estudent);
                adm.actualizar(ret);
         }else{
                Retiran ret = new Retiran(adm.getNuevaClave("Retiran","codigo"));
                ret.setApellidos(nom22.value);
                ret.setParentesco(par22.value);
                ret.setCedula(ci22.value);
                ret.setTipo("R");
                ret.setEstudiante(estudent);
                adm.guardar(ret);
         }
         
         if(!(cod33.value).equals(0)){
                Retiran ret = new Retiran(cod33.value);
                ret.setApellidos(nom33.value);
                ret.setParentesco(par33.value);
                ret.setCedula(ci33.value);
                ret.setTipo("R");
                ret.setEstudiante(estudent);
                adm.actualizar(ret);
         }else{
                Retiran ret = new Retiran(adm.getNuevaClave("Retiran","codigo"));
                ret.setApellidos(nom33.value);
                ret.setParentesco(par33.value);
                ret.setCedula(ci33.value);
                ret.setTipo("R");
                ret.setEstudiante(estudent);
                adm.guardar(ret);
         }
         
         if(!(cod1.value).equals(0)){
                Retiran ret = new Retiran(cod1.value);
                ret.setApellidos(nom1.value);
                ret.setParentesco(par1.value);
                ret.setTelefono1(cel1.value);
                ret.setTelefono2(con1.value);
                ret.setEstudiante(estudent);
                ret.setTipo("E");
                adm.actualizar(ret);
         }else{
                Retiran ret = new Retiran(adm.getNuevaClave("Retiran","codigo"));
                ret.setApellidos(nom1.value);
                ret.setParentesco(par1.value);
                ret.setTelefono1(cel1.value);
                ret.setTelefono2(con1.value);
                ret.setTipo("E");
                ret.setEstudiante(estudent);
                adm.guardar(ret);
         }
           if(!(cod2.value).equals(0)){
                Retiran ret = new Retiran(cod2.value);
                ret.setApellidos(nom2.value);
                ret.setParentesco(par2.value);
                ret.setTelefono1(cel2.value);
                ret.setTelefono2(con2.value);
                ret.setEstudiante(estudent);
                ret.setTipo("E");
                adm.actualizar(ret);
         }else{
                Retiran ret = new Retiran(adm.getNuevaClave("Retiran","codigo"));
                ret.setApellidos(nom2.value);
                ret.setParentesco(par2.value);
                ret.setTelefono1(cel2.value);
                ret.setTelefono2(con2.value);
                ret.setTipo("E");
                ret.setEstudiante(estudent);
                adm.guardar(ret);
         }
         if(!(cod3.value).equals(0)){
                Retiran ret = new Retiran(cod3.value);
                ret.setApellidos(nom3.value);
                ret.setParentesco(par3.value);
                ret.setTelefono1(cel3.value);
                ret.setTelefono2(con3.value);
                ret.setTipo("E");
                ret.setEstudiante(estudent);
                adm.actualizar(ret);
         }else{
                Retiran ret = new Retiran(adm.getNuevaClave("Retiran","codigo"));
                ret.setApellidos(nom3.value);
                ret.setParentesco(par3.value);
                ret.setTelefono1(cel3.value);
                ret.setTelefono2(con3.value);
                ret.setTipo("E");
                ret.setEstudiante(estudent);
                adm.guardar(ret);
         }
          


//GUARDAR MATRICULA
        matricula.setCodigomat(codigomat.value);
        matricula.setEstudiante(estudent);
        matricula.setObservacion(observacion.value);
        matricula.setFechamat(fechamatricula.value);
        matricula.setFecharet(fecharetiro.value);
        matricula.setCurso(curso.selectedItem.value);
        matricula.setNumero(numero.value);
        matricula.setEstado(accion.value);
        matricula.setNuevo(nuevo.checked);
        matricula.setRepite(new Integer(repite.selectedItem.value));
        matricula.setInstitucion(institucion.value);
        matricula.setPerdio(perdio.checked);
        matricula.setSuspenso(suspenso.checked);

        try{
            matricula.setBeca((beca.value).doubleValue());
            matricula.setOtros((otros.value).doubleValue());
        }catch(Exception ea){}

         if(matricula.getEstado().equals("Inscrito")){
            matricula.setNumero(0);
         }

           

            //matricula.setFoto(nueva.getByteData());
            matricula.setFolio(folio.value);

            org.zkoss.image.Image nueva = foto0.getContent();
 
        if((!matricula.getCodigomat().equals(0)) ){

                if(matricula.getNumero().equals(0)){
                    matricula.setNumero(nuevaMatricula());
                }
            if(!nueva.getName().equals("vacio")){
                InputStream objin=nueva.getStreamData();
            String  name =  periodo.getInstitucion().getFotos()+matricula.getCodigomat()+"."+nueva.getFormat();
            FileOutputStream out=new FileOutputStream(name);
            DataOutputStream objout=new DataOutputStream(out);
            org.zkoss.io.Files.copy(objout,objin);
            mini.reducir(periodo.getInstitucion().getFotos(),matricula.getCodigomat()+"",nueva.getFormat()+"");
            //String ubicacion, String nombre, String formato
            matricula.setExtension(nueva.getFormat());
        }else{
            matricula.setExtension(null);
        }
        if(folio.value == "" || folio.value == null ){
                        matricula.setFolio(matricula.getNumero());
                        folio.value = matricula.getNumero();
                    }
                adm.actualizar(matricula);

         }else{

                if(matricula.getEstado().equals("Matriculado")){
                    if(matricula.getNumero().equals(0)){
                        matricula.setNumero(nuevaMatricula());
                        numero.value = matricula.getNumero();
                    }
                    if(folio.value == "" || folio.value == null ){
                        matricula.setFolio(matricula.getNumero());
                        folio.value = matricula.getNumero();
                    }

                }else{
                    matricula.setNumero(0);
                }
                 Integer matri = adm.getNuevaClave("Matriculas","codigomat");
             matricula.setCodigomat(matri);
             if(!nueva.getName().equals("vacio")){
            String  name =  periodo.getInstitucion().getFotos()+matricula.getCodigomat()+"."+nueva.getFormat();
                InputStream objin=nueva.getStreamData();
             FileOutputStream out=new FileOutputStream(name);
            DataOutputStream objout=new DataOutputStream(out);
                org.zkoss.io.Files.copy(objout,objin);
                matricula.setExtension(nueva.getFormat());
             }else{
                matricula.setExtension(null);
             }
             adm.guardar(matricula);
             codigomat.value = matri;
         }


//TERMINA AREA DE MATRICULA
        cargandoFoto = false;
        Messagebox.show("Registro Almacenado con Éxito...!", "Administrador Educativo", Messagebox.OK, Messagebox.INFORMATION);
        guardar.disabled=true;
        agregar.disabled=false;
        guardar3.disabled=true;
        agregar3.disabled=false;
        estado(true,false);
        //representante0.setTipoidentificacion("CF");
        acta.disabled = false;
        certificado.disabled = false;
        certificado2.disabled = false;
        claveprint.disabled = false;
        acta3.disabled = false;
        certificado3.disabled = false;
        certificado23.disabled = false;
        claveprint3.disabled = false;
        //llenar(new Estudiantes(0));
            combo.value="";
            permiso.auditar("Matriculas","Guardar",""+matricula.getCodigomat()+" "+matricula.getEstudiante().getApellido());
        //aqui trabajo la parte de pensiones

//******************************** PARA CONTABLE ****************************************************************

List parametros =  adm.query("Select o from ParametrosGlobales as o where o.variable = 'TRABAJARUBROS' and o.periodo.codigoper = '"+periodo.getCodigoper()+"' ");
ParametrosGlobales para = new ParametrosGlobales();
        if(parametros.size()>0){
            para = parametros.get(0);
        }else{
            para.setBvalor(false);
        }
        if(para.getBvalor()){

          matriculasBean mati = new matriculasBean();
          mati.generar(periodo);
          //mati.generar(repreNuevo,estuNuevo,matricula,periodo);
         }
//*****************************************************************************

        }catch(Exception e){
                alert("Error:"+e); System.out.println(""+e.getCause()); System.out.println(""+e.getLocalizedMessage());                System.out.println(""+e.getMessage());
                System.out.println(""+e.getStackTrace()); System.out.println(""+e.getCause());
        }
    guardando = false;
}

   Boolean verificar(String accion){
        return permiso.verificarPermiso("Matricular",accion);

    }
 void nuevo(){
    if(verificar("Agregar")){
       try{
        cod1.value = 0; nom1.value =""; par1.value = ""; cel1.value = ""; con1.value="";
        cod2.value = 0;nom2.value =""; par2.value = ""; cel2.value = ""; con2.value="";
        cod3.value = 0;nom3.value =""; par3.value = ""; cel3.value = ""; con3.value="";

        cod11.value = 0; nom11.value =""; par11.value = ""; ci11.value="";
        cod22.value = 0; nom22.value =""; par22.value = ""; ci22.value="";
        cod33.value = 0; nom33.value =""; par33.value = ""; ci33.value="";

        codh1.value = 0; codh2.value = 0; codh3.value = 0; 
        nomh1.value ="";nomh2.value ="";nomh3.value ="";
        anioh1.value ="";  anioh2.value =""; anioh3.value =""; 
        guardar.disabled=false;
        guardar3.disabled=false;
        llenar(new Estudiantes(0));
        estado(false,false);
        llenarConsumidor();
        cod1.value = 0;
        cod2.value = 0;
        cod3.value = 0;
        cod11.value = 0;
        cod22.value = 0;
        cod33.value = 0; 
        }catch(Exception e){
        alert(""+e);
        }

    }else{
            Messagebox.show("No tiene permisos para realizar esta acción...!", "Administrador Educativo", Messagebox.OK, Messagebox.ERROR);
    }
}
 void move(){
        llenar((Estudiantes)datos.selectedItem.value);
        modificar.disabled = false;
        acta.disabled = false;
        certificado.disabled = false;
        certificado2.disabled = false;
        claveprint.disabled = false;
        combo.value="";
          registro.setSelected(true);
  }
void modificar(){
  if(verificar("Modificar")){
       guardar.disabled=false;
       guardar3.disabled=false;
        estado(false,false);
    }else{
            Messagebox.show("No tiene permisos para realizar esta acción...!", "Administrador Educativo", Messagebox.OK, Messagebox.ERROR);
    }
}
void eliminar(){
  if(verificar("Eliminar")){
        try{
             adm.eliminarObjeto(Matriculas.class, new Integer(codigomat.value));
             llenarMatricula(new Matriculas(0));
             codigomat.value = 0;
             //CAMBIO DE ESTADO AL ESTUDIANTE
             Estudiantes est = adm.buscarClave(codigo.value,Estudiantes.class);
             est.setMatriculado(false);
             adm.actualizar(est);
             llenar(est);
             
                Messagebox.show("Matrícula Eliminada con Éxito...!", "Administrador Educativo", Messagebox.OK, Messagebox.INFORMATION);
        }catch(Exception e){
            Messagebox.show("No se pudo eliminar el Registro...!", "Administrador Educativo", Messagebox.OK, Messagebox.ERROR);
        }
}else{
            Messagebox.show("No tiene permisos para realizar esta acción...!", "Administrador Educativo", Messagebox.OK, Messagebox.ERROR);
    }
}
void buscarEstudiante(String valor){
//cargandoFoto = false;
int ini = valor.indexOf("[");
int fin = valor.indexOf("]");
valor = valor.substring(ini+1, fin);
            List empleados = adm.query("Select o from Estudiantes as o where o.codigoest = '"+valor+"' ");
            if(empleados.size()>0){
                for(Iterator it = empleados.iterator(); it.hasNext();) {
                      Estudiantes object = (Estudiantes)it.next();
                      estudent = object;
                 }
            llenar(estudent);
                           
            
            List retiranList = adm.query("Select o from Retiran as o where o.estudiante.codigoest = '"+valor+"'  and o.tipo = 'R' order by o.codigo ");
            cod11.value = 0; nom11.value =""; par11.value = ""; ci11.value="";
               cod22.value = 0; nom22.value =""; par22.value = ""; ci22.value="";
               cod33.value = 0; nom33.value =""; par33.value = ""; ci33.value="";
            if(retiranList.size()>0){
                int i=0;
                for(Iterator it = retiranList.iterator(); it.hasNext();) {
                      Retiran es = (Retiran)it.next();
                      if(i==0){
                            cod11.value = es.getCodigo(); 
                            nom11.value =es.getApellidos();
                            par11.value =es.getParentesco(); 
                            ci11.value=es.getCedula();
                      }else if(i==1){
                            cod22.value =  es.getCodigo();  
                            nom22.value =es.getApellidos(); 
                            par22.value =es.getParentesco(); 
                            ci22.value=es.getCedula();       
                      }else if(i==2){
                            cod33.value =  es.getCodigo(); 
                            nom33.value =es.getApellidos(); 
                            par33.value = es.getParentesco(); 
                            ci33.value=es.getCedula();       
                      }
                      i++;
                 }
            }else{
               cod11.value = 0; nom11.value =""; par11.value = ""; ci11.value="";
               cod22.value = 0; nom22.value =""; par22.value = ""; ci22.value="";
               cod33.value = 0; nom33.value =""; par33.value = ""; ci33.value="";
             }
             
             List emergenciaList = adm.query("Select o from Retiran as o where o.estudiante.codigoest = '"+valor+"'  and o.tipo = 'E' order by o.codigo ");
             cod1.value = 0; nom1.value =""; par1.value = ""; cel1.value = ""; con1.value="";
                cod2.value = 0;nom2.value =""; par2.value = ""; cel2.value = ""; con2.value="";
                cod3.value = 0;nom3.value =""; par3.value = ""; cel3.value = ""; con3.value="";
            if(emergenciaList.size()>0){
                int i=0;
                for(Iterator it = emergenciaList.iterator(); it.hasNext();) {
                      Retiran es = (Retiran)it.next();
                      if(i==0){
                            cod1.value =es.getCodigo(); 
                            nom1.value =es.getApellidos();
                            par1.value =es.getParentesco(); 
                            cel1.value=es.getTelefono1();
                            con1.value=es.getTelefono2();
                      }else if(i==1){
                            cod2.value =  es.getCodigo();  
                            nom2.value =es.getApellidos(); 
                            par2.value =es.getParentesco(); 
                            cel2.value=es.getTelefono1();
                            con2.value=es.getTelefono2();
                      }else if(i==2){
                            cod3.value =  es.getCodigo(); 
                            nom3.value =es.getApellidos(); 
                            par3.value = es.getParentesco(); 
                            cel3.value=es.getTelefono1();
                            con3.value=es.getTelefono2();
                      }
                      i++;
                 }
            }else{
                 cod1.value = 0; nom1.value =""; par1.value = ""; cel1.value = ""; con1.value="";
                cod2.value = 0;nom2.value =""; par2.value = ""; cel2.value = ""; con2.value="";
                cod3.value = 0;nom3.value =""; par3.value = ""; cel3.value = ""; con3.value="";
             }
             
       List hermanosList = adm.query("Select o from Hermanos as o " + 
       " where o.estudiante.codigoest = '"+valor+"' ");
                            codh1.value = 0; codh2.value = 0; codh3.value = 0; 
                            nomh1.value ="";nomh2.value ="";nomh3.value ="";
                            anioh1.value ="";  anioh2.value =""; anioh3.value =""; 
            if(hermanosList.size()>0){
                int i=0;
                for(Iterator it = hermanosList.iterator(); it.hasNext();) {
                      Hermanos es = (Hermanos)it.next();
                      if(i==0){
                            codh1.value =es.getHermanos().getCodigoest(); 
                            nomh1.value =es.getHermanos().getApellido() +" "+es.getHermanos().getNombre();
                            anioh1.value =es.getCurso(); 
                      }else if(i==1){
                            codh2.value =es.getHermanos().getCodigoest(); 
                            nomh2.value =es.getHermanos().getApellido() +" "+es.getHermanos().getNombre();
                            anioh2.value =es.getCurso(); 
                      }else if(i==2){
                            codh3.value =es.getHermanos().getCodigoest(); 
                            nomh3.value =es.getHermanos().getApellido() +" "+es.getHermanos().getNombre();
                            anioh3.value =es.getCurso(); 
                      }
                      i++;
                 }
            }else{
                            codh1.value = 0; codh2.value = 0; codh3.value = 0; 
                            nomh1.value ="";nomh2.value ="";nomh3.value ="";
                            anioh1.value ="";  anioh2.value =""; anioh3.value =""; 
                             
             }
            modificar.disabled=false;
            acta.disabled = false;
            certificado.disabled = false;
            certificado2.disabled = false;
            claveprint.disabled = false;
            eliminar.disabled=false;
             modificar3.disabled=false;
            acta3.disabled = false;
            certificado3.disabled = false;
            certificado23.disabled = false;
            claveprint3.disabled = false;
            eliminar3.disabled=false;
            }else{
                estudent = new Estudiantes(0);
            }

    }
void buscarRepresentante(String valor){

int ini = valor.indexOf("[");
int fin = valor.indexOf("]");
valor = valor.substring(ini+1, fin);
            List empleados = adm.query("Select o from Representante as o where o.codigorep = '"+valor+"' ");
            if(empleados.size()>0){
                Representante object = null;
                for(Iterator it = empleados.iterator(); it.hasNext();) {
                 object = (Representante)it.next();
                      //estudent = object;
                 }
            llenarRepresentante(object);
            modificar.disabled=false;
            }else{
                estudent = new Representante(0);
            }

    }
    void limpiarRepresentante(){
            Representante object = new Representante();
            object.setCodigorep(0);
            object.setTipoidentificacion("C");
            llenarRepresentante(object);
    }
  void verificarCedula(String valor){
      if(valor.length()>9){
            List empleados = adm.query("Select o from Estudiantes as o where o.cedula = '"+valor+"' ");
            if(empleados.size()>0){
                Messagebox.show("Número de Identificación ya registrado...!", "Administrador Educativo", Messagebox.OK, Messagebox.EXCLAMATION);

                for(Iterator it = empleados.iterator(); it.hasNext();) {
                      Estudiantes object = (Estudiantes)it.next();
                        estudent = object;
                 }
            llenar(estudent);

            }else{
                estudent = new Estudiantes(0);
            }

        }
    }


  void buscar(String p){
        List empleadosEncontrados = adm.query("Select o.estudiante from Matriculas as o " +
        " where o.estudiante.apellido like '%"+p+"%' and o.curso.periodo.codigoper = '"+periodo.getCodigoper()+"'   order by o.estudiante.apellido");
        datos = new Listbox();
        int a=0;
            for (Iterator it = datos.getItems().iterator(); it.hasNext();) {
                    datos.getItems().remove(a);
                }
               for (Iterator it = empleadosEncontrados.iterator(); it.hasNext();) {
                      Estudiantes acceIt = (Estudiantes) it.next();
                      Listitem li = new Listitem();
                      li.setValue(acceIt);
                      li.appendChild(new Listcell(acceIt.getCedula()+""));
                      li.appendChild(new Listcell(acceIt.getApellido()+" "+acceIt.getNombre()));
                      li.appendChild(new Listcell(acceIt.getDireccion()+""));
                      datos.appendChild(li);
             }

    }
void cargar(Global g){
    estudent.setPerfil(g);
}

void llenarConsumidor(){


    cedulafac.value = "";
    nombresfac.value = "";
    direccionfac.value = "";
    telefonofac.value = "";



}



//PARA REPORTES
public JRDataSource certificados(Matriculas matricula,String tipo){
      Administrador adm = new Administrador();
      Session ses = Sessions.getCurrent();
        Periodo periodo = (Periodo) ses.getAttribute("periodo");
        ArrayList detalle = new ArrayList();
        String query = "SELECT mat FROM Matriculas AS mat " +
                "WHERE  mat.estado like '%Matriculado%' " +
                "and mat.codigomat = '" + matricula.getCodigomat() + "' ";
        List hoy = adm.query(query);
        for (Iterator it = hoy.iterator(); it.hasNext();) {
            Matriculas elem = (Matriculas) it.next();
            detalle.add(elem);
        }
        JRDataSource ds = null;
        if(tipo.equals("CM")){
             ds = new ReporteCertificadoDataSource(detalle);
        }else{
              ds = new ReporteActaDataSource(detalle);
        }
        return ds;

}
        void showReport(String tipo) {
            //Preparing parameters

            Institucion insts = periodo.getInstitucion();

            Map parametros = new HashMap();
            parametros.put("denominacion", insts.getDenominacion());
            parametros.put("nombre", insts.getNombre());
            parametros.put("periodo", periodo.getDescripcion());
            parametros.put("slogan", insts.getSlogan());
            parametros.put("secretaria", insts.getSecretaria());
            parametros.put("rectora", insts.getRector());
            JRDataSource datasource = null;
            String directorioReportes = insts.getReportes();
             
            if(tipo.equals("CM")){
                    datasource = certificados(new Matriculas(codigomat.value),tipo);
                    report.setSrc(directorioReportes+"certificadoMatricula.jasper");
                    parametros.put("titulo", "Certificado de Matricula");
            }else if(tipo.equals("CM2")){
                    datasource = certificados(new Matriculas(codigomat.value),tipo);
                    report.setSrc(directorioReportes+"certificadoMatricula2.jasper");
                    parametros.put("titulo", "Certificado de Matricula");
            } else if(tipo.equals("AM")){
                    datasource = certificados(new Matriculas(codigomat.value),tipo);
                    parametros.put("titulo", "Acta de Matricula");
                    report.setSrc(directorioReportes+"actaMatricula.jasper");

            } else if(tipo.equals("CL")){
                    datasource = certificados(new Matriculas(codigomat.value),tipo);
                    parametros.put("titulo", "Acta de Matricula");
                    report.setSrc(directorioReportes+"clavePersonal.jasper");

            } else if(tipo.equals("CAR")){
                    datasource = certificados(new Matriculas(codigomat.value),tipo);
                    parametros.put("titulo", "Carnet ");
                    report.setSrc(directorioReportes+"carnetIndividual.jasper");

            } else if(tipo.equals("CARM")){
                    datasource = certificados(new Matriculas(codigomat.value),tipo);
                    parametros.put("titulo", "Carnet ");
                    report.setSrc(directorioReportes+"carnetMinisterioIndividual.jasper");

            }
            if(!tipo.equals("-1")){
                report.setParameters(parametros);
                report.setDatasource(datasource);
                report.setType("pdf");
            }
        }

    anadirRetiro(){
                try{
                    Row row = new Row();
                      
                      //CARGO LAS SERIES COMO ATRIBUTO
                       
                    
                           Doublebox dou = new Doublebox(0);
                            dou.setStyle("float:right;text-align:right");
                            dou.setValue(vu.value);
                            Intbox intb = new Intbox(cantidad.value);
                            intb.setCols(3);
                            intb.setReadonly(true);
                             intb.setStyle("float:right;text-align:right");
                            Label prod = new Label(productod.value);
                            row.appendChild(intb);
                            row.appendChild(prod);
                            row.appendChild(dou);
                            
                            Button aButton = null;
                            aButton = new Button("quitar");
                            aButton.setImage("/images/quitar.gif");
                            aButton.setHeight("5px");
                            aButton.setId("id"+idproducto.value);
                            aButton.addEventListener("onClick", new EventListener() {
                                public void onEvent(Event event) throws Exception {
                                     int valor0 = Messagebox.show("Seguro que desea quitar este elemento, Desea Continuar?", "JCINFORM-Seguridad", Messagebox.YES | Messagebox.NO, Messagebox.QUESTION);
                                     seriespanel.visible = false;
                                     if(valor0 == 16){
                                        quitarFila(aButton.getId());
                                     }
                                        
                                }
                            });
                            row.appendChild(aButton);
                            
                            row.setValue(new Equipos(idproducto.value)); 
                    filas.appendChild(row);
                    }catch(Exception e){
                        alert("YA SE HA AGREGADO ESTE PRODUCTO");
                    }
                        vu.value=null;
                        cantidad.value= null;
                        productod.value=null;
                        idproducto.value = null;
                        cantidad.focus();
  
}

public void quitarFila(String codigoBuscar){
                 Rows filas2 =opciones.getRows();
                List listadoProductos = filas2.getChildren();
                    for (int i = 0; i <= listadoProductos.size()-1; i++) {
                       Row object = (Row) listadoProductos.get(i);
                       Equipos nuevo = ((Equipos)object.getValue());
                       String codigoA = "id"+nuevo.getCodigo();
                       if(codigoA.equals(codigoBuscar)){
                            opciones.getRows().removeChild(object);
                            break;
                       }
                    }

}
 

  ]]>
    </zscript>
    <vbox id="botones1">
        <hbox>
            <button image="/images/guardar.gif" id="guardar3" label="Guardar"  disabled="true"  onClick="guardar();"/>
            <button  image="/images/nuevo.gif" id="agregar3" label="Agregar" onClick='cargandoFoto = false;combo.value="";nuevo();'  />
            <button  image="/images/editar.gif" id="modificar3"  label="Modificar" disabled="true" onClick="modificar()"/>
            <button  image="/images/imprimir.gif" id="acta3"  label="Acta" disabled="true"  onClick='showReport("AM"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; '/>
            <button  image="/images/imprimir.gif" id="certificado3"  label="Certificado" disabled="true"  onClick='showReport("CM"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; ' />
            <button  image="/images/imprimir.gif" id="certificado23"  label="Certificado2" disabled="true"  onClick='showReport("CM2"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; '/>
            <button  image="/images/imprimir.gif" id="claveprint3"  label="Clave" disabled="true"  onClick='showReport("CL"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; ' />
            <button  image="/images/imprimir.gif" id="carnetprint3"  label="Carnét" disabled="false"  onClick='showReport("CAR"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; ' />
            <button  image="/images/imprimir.gif" id="carnetprintm3"  label="Carnét M." disabled="false"  onClick='showReport("CARM");  contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; ' />
            <button  image="/images/eliminar.gif" id="eliminar3"  label="Eliminar(Matricula)" disabled="true"  onClick="eliminar();"/>
        </hbox>
    </vbox>
    <vbox id="contenido" >
 
                <portallayout>
                    <portalchildren style="padding: 5px" width="50%">
                  
                        <panel   title="DATOS DEL ESTUDIANTE"  framable="true"   border="normal" collapsible="true" >
                            <panelchildren>
                                <grid sclass="MyGridRowHeight" width="600px"   height="100%">
                                    <rows>

                                        <row style="background:yellow">
                                            <span style="float:right"> BÚSQUEDA: </span>
                                            <span>
                                                <combobox  cols="35" id="combo" onSelect="buscarEstudiante(self.selectedItem.label)" autodrop="true" buttonVisible="false"  use="bean.AutoComplete"/>
                                                _INGRESE UN APELLIDO
                                            </span>
                                        </row>
                                        <row>

                                            <span style="float:right"> Codigo :</span>
                                            <span>
                                                <intbox  maxlength="14" cols="5"  disabled="true"  readonly="true" id="codigo"  />
                                                Identificación:
                                                <textbox maxlength="10" cols="13" onChange="verificarCedula(self.value)" readonly="true" id="cedula"  />
                                                                        
                                            </span>
                                        </row>
                                        <row>

                                            <span style="float:right;">
                                                <label value="Nombres(*)" style="font-weight: bold;"/>
                                            </span>
                                            <textbox id="nombres"  maxlength="60" cols="40" readonly="true"   />
                                        </row>

                                        <row>

                                            <span style="float:right;">
                                                <label value="Apellidos(*)" style="font-weight: bold;"/>
                                            </span>
                                            <textbox id="apellidos" onBlur="generarClave(false);"  maxlength="60" cols="40" readonly="true"  />
                                        </row>
                                        <row>

                                            <span style="float:right;">
                                                <label value="Dirección(*)" style="font-weight: bold;"/>
                                            </span>
                                            <span>
                                                <textbox id="direccion" maxlength="100" cols="40"  readonly="true"    />
                                                Barrio:
                                                <textbox id="barrio" maxlength="100" cols="15"  readonly="true"    />
                                            </span>
                                        </row>

                                        <row>
                                            <span style="float:right"> Email:</span>
                                            <span>
                                                <textbox id="mail" maxlength="100" cols="40"  readonly="true"    />
                                                Teléfono:
                                                <textbox id="telefono" maxlength="50" cols="15"  readonly="true"  />
                                            </span>
                                        </row>

                                    </rows>
                                </grid>

                                <grid>
                                    <rows>
                                        <row>
                                            <span>
                                                <grid width="200px" height="100%" sclass="MyGridRowHeight" >
                                                    <rows>
                                                        <row>
                                                            <span  style="border:1px">
                                                                <button id="subirb" disabled="true" image="/images/subir.png" label="Subir">
                                                                    <attribute name="onClick">{
                                                                        Object media = Fileupload.get();

                                                                        if (media instanceof org.zkoss.image.Image) {
                                                                        foto0.setContent(media);
                                                                        foto0.visible = true;    

                                                                        } else if (media != null)
                                                                        Messagebox.show("Seleccione una Imagen: "+media, "Error", Messagebox.OK, Messagebox.ERROR);
                                                                        media = null;
                                                                        }
                                                                    </attribute>
                                                                </button>
                                                                <button label="Tomar " disabled="true" id="nuevoE" image="/images/subir.png" >
                                                                    <attribute name="onClick">{
                                                                        final Window win = (Window) Executions.createComponents("tomarFoto.zul", null, null);
                                                                        win.setMaximizable(true);
                                                                        win.setClosable(true);
                                                                        win.setAttribute("nuevo", true);
                                                                        win.setTitle("Tomar Fotografía");
                                                                        win.doModal();
                                                                        }                            
                                                                    </attribute>
                                                                </button> 

                                                            </span>
                                                        </row>
                                                        <row>
                                                            <span style="border:1px">
                                                                <image border="1" height="117px"  id="foto0"/>
                                                                    <!--vbox width="50px" height="125px" style="border:1px" id="miimagen"/-->
                                                            </span>
                                                        </row>
                                                    </rows>
                                                </grid>
                                            </span>
                                            <span>
                                                <grid  sclass="MyGridRowHeight" width="100%" height="100%">
                                                    <rows>
                                                        <row>
                                                            <span style="float:right;">
                                                                <label value="Género(*)" style="font-weight: bold;"/>
                                                            </span>
                                                            <combobox id="genero" readonly="true">
                                                                <comboitem value="Masculino" label="Masculino"/>
                                                                <comboitem value="Femenino" label="Femenino"/>
                                                            </combobox>
                                                        </row>
                                                        <row>
                                                            <span style="float:right"> Fecha Nacimiento:</span>
                                                            <datebox id="nacido"  readonly="true"  />

                                                        </row>
                                                        <row>
                                                            <span style="float:right"> Usuario:</span>
                                                            <span>
                                                                <textbox id="usuario" maxlength="30" cols="12" readonly="true"  />

                                                                <button label="Generar" onClick="generarClave(true);"/>
                                                            </span>


                                                        </row>
                                                        <row>
                                                            <span style="float:right"> Clave:</span>
                                                            <span>
                                                                <textbox id="clave"   maxlength="30" cols="15" readonly="true"  />
                                                                <checkbox visible="false" id="estadoe" disabled="true"  />
                                                            </span>
                                                        </row>
                                                        <row>

                                                            <span style="float:right"> Es Interno?:</span>
                                                            <span>
                                                                <checkbox id="adventista" disabled="true" /> Es Nuevo?:
                                                                <checkbox id="nuevo" disabled="true" />
                                                            </span>

                                                        </row>
                                                        <row>
                                                            <span style="float:right"> Religión:</span>
                                                            <combobox id="religion" readonly="true">
                                                                <comboitem  value="Ninguno" label="Ninguno"/>
                                                                <comboitem value="Adventista" label="Adventista"/>
                                                                <comboitem value="Cristiano" label="Cristiano"/>
                                                                <comboitem value="Evangélico" label="Evangélico"/>
                                                                <comboitem value="Católico" label="Catolico"/>
                                                                <comboitem value="Otra" label="Otra"/>


                                                            </combobox>
                                                        </row>
                                                    </rows>
                                                </grid>
                                            </span>
                                        </row>
                                    </rows>
                                </grid>
                                    
                            </panelchildren>
                        </panel>
            <panel collapsible="true"   
                               framable="true"  title="DATOS DEL PADRE"
                               border="normal" >
                            <panelchildren>
                                <grid sclass="MyGridRowHeight">
                                    <rows>
                                        
                                        <row>
                                            <span style="float:right"> Identificación:</span>
                                            <textbox maxlength="10" cols="13"  readonly="true" id="cedulapa"  />
                                        </row>
                                        <row>
                                            <span style="float:right"> Nombres:</span>
                                            <span>
                                                <textbox id="nombrespa"  maxlength="60" cols="20" readonly="true"   />
                                                <intbox maxlength="14" cols="5"  readonly = "true"   visible="false"  id="codigore"  />
                                        
                                                <span > Apellidos:</span>
                                                <textbox id="apellidospa"  maxlength="60" cols="20" readonly="true"  />
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> Ocupación:</span>
                                            <span>
                                                <textbox id="ocupacionpa" maxlength="100" cols="20"  readonly="true"    />
                                      
                                                <span > Profesión:</span>
                                                <textbox id="profesionpa" maxlength="100" cols="20"  readonly="true"    />
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> Dirección:</span>
                                            <span>
                                                <textbox id="direccionpa" maxlength="100" cols="40"  readonly="true"    />
                                                <button label="..." onClick="direccionpa.value = direccion.value" />
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> Teléfono:</span>
                                            <span>
                                                <textbox id="telefonopa" maxlength="100" cols="13"  readonly="true"  />
                                                <button label="..." onClick="telefonopa.value = telefono.value" />
                                                <span > Email:</span>
                                                <textbox id="emailpa" maxlength="100" cols="35"  readonly="true"    />
                                            </span>
                                        </row>
                                       
                                    </rows>
                                </grid>
                                    
                            </panelchildren>
                        </panel>
                      
                        <panel collapsible="true"   framable="true"  title="DATOS DE LA MADRE" border="normal" >
                            <panelchildren>
                                <grid sclass="MyGridRowHeight">
                                    <rows>
 
                                        <row>
                                            <span style="float:right"> Identificación:</span>
                                            <textbox maxlength="10" cols="13"  readonly="true" id="cedulama"  />
                                        </row>

                                        <row>
                           
                                            <span style="float:right"> Nombres:</span>
                                            <span>
                                            
                                                <textbox id="nombresma"  maxlength="60" cols="20" readonly="true"   />
                                                <span> Apellidos:</span>
                                                <textbox id="apellidosma"  maxlength="60" cols="20" readonly="true"  />
                                                
                                            </span>
                                        </row>

                                        <row>
                         
                                            <span style="float:right"> Ocupación:</span>
                                            <span>
                                                <textbox id="ocupacionma" maxlength="100" cols="20"  readonly="true"    />
                                            
                                                <span> Profesión:</span>
                                                <textbox id="profesionma" maxlength="100" cols="20"  readonly="true"    />
                                            </span>
                                        </row>
                                        <row>
                              
                                            <span style="float:right"> Dirección:</span>
                                            <span>
                                                <textbox id="direccionma" maxlength="100" cols="40"  readonly="true"    />
                                                <button label="..." onClick="direccionma.value = direccion.value" />
                                            </span>
                                        </row>
                                        <row>
                                
                                            <span style="float:right"> Teléfono:</span>
                                            <span>
                                                <textbox id="telefonoma" maxlength="50" cols="13"  readonly="true"  />
                                                <button label="..."  onClick="telefonoma.value = telefono.value" />
                                                <span > Email:</span>
                                                <textbox id="emailma" maxlength="100" cols="35"  readonly="true"    />
                                            </span>
                                        </row>
                                     

                                    </rows>
                                </grid>

                            </panelchildren>
                        </panel>
                        
                        <panel style="margin-bottom:10px" title="DATOS VARIOS" border="normal">
                                    <panelchildren>          
                                        <grid sclass="MyGridRowHeight">
                                            <rows>
                                                <row visible="false">
                                                    <span  style="float:right">
                                                        YA SE MATRICULÓ:
                                                    </span>
                                                    <span>
                                                        <checkbox id="matriculado"/>
                                                        CODIGO DE MATRICULACIÓN:
                                                        <textbox id="codigoclave"  />
                                                        BLOQUEADO
                                                        <checkbox id="pendientes"/>
                                                        <checkbox visible = "false"  id="aplico"/>
                                                        <checkbox visible = "false"  id="perdio"/>
                                                        <checkbox visible = "false"  id="suspenso"/>
                                                    </span>
                                                </row>
                                                <row >
                                                    <span style="float:right">Lugar Ocupa  (*) :
                                                    </span>
                                                    <span>
                                                        <spinner value="1" cols="2" id="lugar"  constraint="no negative,no zero,min 0 max 20" />
                                                        Con quién vive (*):
                                        
                                                        <combobox value="Padres"  id="vivecon" >
                                                            <comboitem label="Padres"/>
                                                            <comboitem label="Solo Madre"/>
                                                            <comboitem label="Solo Padre"/>
                                                            <comboitem label="Abuelos"/>
                                                            <comboitem label="Tíos"/>
                                                            <comboitem label="Encargado a Otros"/>
                                                        </combobox>
                                                    </span>
                                                </row>
                                                <row >
                                                    <span style="float:right">Est.Civil Padres:
                                                    </span>
                                                    <span>
                                                        <radiogroup Id="estadocivil" >
                                                            <radio selected="true" label="Casados"/>
                                                            <radio label="Divorciados"/>
                                                            <radio label="Madre Soltera"/>
                                                            <radio label="Viudo(a)"/>
                                                            <radio label="Separados"/>
                                                            <radio label="U.Libre"/>                                                            
                                                        </radiogroup>
                                                    </span>
                                                </row>
                                                <row>
 
                                                    <span style="float:right">Ingresos:</span>
                                                    <span>
                                                        Padre:
                                                        <intbox id="ingpadre" cols="10"  />
                                                        Madre:
                                                        <intbox id="ingmadre" cols="10"   />
                                                        Otros:
                                                        <intbox id="ingotros" cols="10"   />
                                                    </span>
                                                </row>
                                                <row>
                                                    <span style="float:right">Tipo Vivienda
                                                        <span style="color:blue"> (*)</span>:
                                                    </span>
                                                    <span>
                                                        <radiogroup Id="casa" >
                                                            <radio selected="true" label="Propia"/>
                                                            <radio label="Arrend."/>
                                                            <radio label="Prestada"/>
                                                            <radio label="Anticresis"/>
                                                            <radio label="Prestamo"/>
                                                            <radio label="Depto."/>
                                                            <radio label="Otros"/>
                                                        </radiogroup>
                                                    </span>
                                                </row>
                                                <row>
                                                    <span style="float:right">Servicios
                                                        <span style="color:blue"> (*)</span>:
                                                    </span>
                                                    <span>

                                                        <checkbox id="luz" label="Luz Electrica"/>
                                                        <checkbox id="agua"  label="Agua"/>
                                                        <checkbox id="sshh"  label="SS.HH."/>
                                                        <checkbox id="pozo"  label="Pozo Séptico"/>
                                                        <checkbox id="telefonob"  label="Teléfono"/>
                                                        <checkbox id="internet"  label="Internet"/>
                                                    </span>

                                                </row>
                              
                                                <row>

                                                    <span style="float:right;font-size:11px">
                                                        <label  style="font-size:11px" value="¿Posee Discapacidad?" id="t16"/>
                                                    </span>
                                                    <span>

                                                        <checkbox id="discapacidad" label="SI" onCheck="tipodiscapacidad.readonly = self.checked? false: true" />
                                                        <label style="font-size:11px"  value="Describa su Discapacidad" id="t160"/>
                                                        <textbox    id="tipodiscapacidad" maxlength="100" cols="30" rows="1"  readonly="true"  />

                                                    </span>
                                                </row>
                                            </rows>
                                        </grid>
                                    </panelchildren>
                                        
                                </panel>
                                   
                                        <panel style="margin-bottom:10px" title="EN CASO DE EMERGENCIA LLAMAR A: " border="normal">
                                            <panelchildren>            
                                                <grid   sclass="MyGridRowHeight" width="100%" id="opciones">
                                                    <columns sizable="true">
                                                        <column visible="false" label="codigo" />
                                                        <column style="font-weight:bold" label="NOMBRES" width="120px" />
                                                        <column label="PARENTESCO" width="50px"  />
                                                        <column label="CELULAR"  width="30px" />
                                                        <column label="CONVENCIONAL" width="30px"  />
                                                    </columns>
                                                    <rows>
                                                        <row>
                                                            <intbox id="cod1" value="0"/>
                                                            <textbox readonly="true"  id="nom1" cols="30" value=""/>
                                                            <textbox readonly="true"  id="par1" value=""/>
                                                            <textbox readonly="true"  id="cel1" cols="10"  value=""/>
                                                            <textbox readonly="true"  id="con1" cols="10"  value=""/>
                                                        </row>
                                                        <row>
                                                            <intbox id="cod2" value="0"/>
                                                            <textbox readonly="true" id="nom2" cols="30"  value=""/>
                                                            <textbox readonly="true"  id="par2"    value=""/>
                                                            <textbox readonly="true"  id="cel2" cols="10"   value=""/>
                                                            <textbox readonly="true"  id="con2" cols="10"   value=""/>
                                                        </row>
                                                        <row>
                                                            <intbox id="cod3" value="0"/>
                                                            <textbox readonly="true"  id="nom3" cols="30"  value=""/>
                                                            <textbox readonly="true"  id="par3"  value=""/>
                                                            <textbox readonly="true"  id="cel3" cols="10"   value=""/>
                                                            <textbox readonly="true"  id="con3" cols="10"   value=""/>
                                                        </row>
                                            
                                                    </rows>
                                                </grid>
                                            </panelchildren>
                                        </panel>  
                     
                    </portalchildren>    
                    <portalchildren style="padding: 5px" width="50%">
                     
                       <panel collapsible="true"   framable="true"  border="normal"  title="DATOS DE MATRICULACIÓN" >
                            <panelchildren>
                                <grid sclass="MyGridRowHeight" width="100%"  height="100%">
                                    <rows>
                                        <row>
                                            <span style="float:right">
                                                                                
                                                <label value="No.Matri.(*)" style="font-weight: bold;"/>
                                            </span>
                                            <span>
                                                                                
                                                <intbox maxlength="10"   cols="5"  id="numero"  />
                                                <span >
                                                    <label value="No.Folio(*)" style="font-weight: bold;"/>
                                                </span>
                                                <intbox maxlength="10" readonly="true" cols="5"  id="folio"  />
                                                <intbox maxlength="14" cols="5"  visible="true"  style="font-size:8px;background:transparent;border:0px"  readonly="true" id="codigomat"  />
                                                                                  
                                                
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right">
                                                                                
                                                <label value="Es la: " style="font-weight: bold;"/>
                                            </span>
                                            <span>
                                            <radiogroup Id="repite" >
                                                    <radio selected="true"  value="0" label="1ra."/>
                                                    <radio value="1"  label="2da."/>
                                                    <radio value="2"  label="3ra."/>
                                                    <radio value="3"  label="4ta."/>
                                           </radiogroup>
                                                Matricula
                                          </span>
                                        </row>
                                        <row>
                                            <span style="float:right;">
                                                <label value="Curso(*)" style="font-weight: bold;"/>
                                            </span>
                                            <bandbox  width="400px" readonly="true"  id="bd1">
                                                <bandpopup>
                                                    <vbox>
                                                        <listbox id="curso" width="660px" rows="10" 
                                                                 onSelect="bd1.value=self.selectedItem.label;bd1.closeDropdown();">
                                                            <listitem selected="true" forEach="${cursos}" value="${each}">
                                                                <listcell label="${each.descripcion} ${each.especialidad}  ${each.paralelo}" />
                                                            </listitem>
                                                        </listbox>
                                                    </vbox>
                                                </bandpopup>
                                            </bandbox>
                                        </row>
                                        <row>
                                            <span style="float:right;">
                                                <label value="Estado(*)" style="font-weight: bold;"/>
                                            </span>
                                            <span>
                                                <combobox readonly="true"   id="accion"  >
                                                    <comboitem  value="Matriculado" label="Matriculado"/>
                                                    <comboitem value="Inscrito" label="Inscrito"/>
                                                    <comboitem value="Retirado" label="Retirado"/>
                                                    <comboitem value="Emitir Pase" label="Emitir Pase"/>
                                                    <comboitem value="Recibir Pase" label="Recibir Pase"/>
                                                    <comboitem value="Anulado" label="Anulado"/>
                                                </combobox>
                                                Inst. Anterior:
                                                <textbox id="institucion" readonly="true"  maxlength="30" cols="20"/>
                                            </span>

                                        </row>
                                        <row>
                                            <span style="float:right;">
                                                <label value="Fec.Matricula(*)" style="font-weight: bold;"/>
                                            </span>
                                            <span>
                                                <datebox id="fechamatricula"  readonly="true"  />
                                                <label value="Fec.Retiro(*)" style="font-weight: bold;"/>
                                                <datebox id="fecharetiro"  readonly="true"  />
                                          
                                                                             
                                            </span>
                                                                
                                        </row>
                                        <row>
                                            <span style="float:right">Toma Transporte:</span>

                                            <span>
                                                <checkbox id="transporte" disabled="true"/>
                                                <textbox id="nobus" maxlength="100" cols="40" readonly="true"  />
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> %Beca:</span>
                                            <span>
                                                <decimalbox id="beca" format="###.##"   maxlength="5" cols="10" readonly="true"  />

                                                Otros Dsctos:
                                                <decimalbox id="otros" format="###.##"   maxlength="5" cols="10" readonly="true"  /> USD
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> ¿Asegurado?:</span>
                                            <span>
                                                  <checkbox id="asegurado"  disabled="true"/>

                                                Nombre Aseguradora:
                                                <textbox id="aseguradora"  maxlength="50" cols="20" readonly="true"  /> 
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> Observación:</span>
                                            <textbox rows="2" id="observacion" cols="65"  readonly="true"  />
                                        </row>
                                        <row>
                                            <span style="float:right">
                                                Provincia: 
                                            </span>
                                            <span>
                                                <textbox cols="20" id="provincia"  />
                                                Canton:
                                                <textbox cols="20"  id="canton"  />
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right">
                                                Parroquia:    
                                            </span> 
                                        
                                            <span>
                                                <textbox  cols="20" id="lugarnacimiento"  />
                                                <span style="color:blue;weight:bold">    
                                                    Nacionalidad(*)
                                                </span>
                                                <textbox id="nacionalidad"  />
                                            </span>
                                        
                                         
                                        </row>
                                          
                                    </rows>
                                </grid>

                            </panelchildren>
                        </panel>
                        <panel collapsible="true"   framable="true"  title="DATOS DE REPRESENTANTE" border="normal" >
                            <panelchildren>
                                <grid sclass="MyGridRowHeight">
                                    <rows>
                                        <row  style="background:yellow">
                                            <span style="float:right">BÚSQUEDA: </span>
                                            <span>
                                                <combobox id="combo2" onSelect="buscarRepresentante(self.selectedItem.label)" autodrop="true" buttonVisible="false"  use="bean.AutoCompleteRepre"/>
                                                APELLIDOS DEL REPRESENTANTE
                                            </span>
                                            
                                        </row>
                                        <row>
                                            <span style="float:right; color:blue" >COPIAR DE:  </span>
                                            <span>
                                                <button id="padrecr" label="Padre" disabled="true" onClick="copiarpr();"/>
                                                <button id="madrecr" label="Madre" disabled="true"  onClick="copiarmr();"/>
                                                <button id="limpiar" label="Nuevo"  disabled="true"  onClick="limpiarRepresentante();"/>
                                            </span>
                                        </row>
                                     
                                        <row>
                                            <span style="float:right"> Identificación:</span>
                                            <textbox maxlength="13" cols="10"   readonly="true" id="cedulare"  />

                                        </row>
                                        <row>
                                            <span style="float:right;">
                                                <label value="Nombres(*)" style="font-weight: bold;"/>
                                            </span>
                                            <span >
                                                <textbox id="nombresre"  maxlength="60" cols="20" readonly="true"   />
                                     
                                            
                                                <label value="Apellidos(*)" style="font-weight: bold;"/>
                                                <textbox id="apellidosre"  maxlength="60" cols="20" readonly="true"  />
                                            </span>
                                            
                                        </row>
                                
                                        <row>
                                            <span style="float:right;">
                                                <label value="Dirección(*)" style="font-weight: bold;"/>
                                            </span>
                                            <span>
                                                <textbox id="direccionre" maxlength="100" cols="30"  readonly="true"    />
                                                <span > Teléfono:</span>
                                                <textbox id="telefonore" maxlength="100" cols="13"  readonly="true"  />
                                
                                            </span>
                                        </row>
                                        
                                        <row>
                                            <span style="float:right"> Email:</span>
                                            <textbox id="emailre" maxlength="100" cols="40"  readonly="true"    />
                                        </row>
                                        <row>
                                            <span  style="float:right">Parentesco</span>
                                            <span>
                                                <textbox id="parentesco" maxlength="100" cols="40"  readonly="true"    />
                                            </span>
                                        </row>
                                
                                        <row>

                                            <span style="float:right"> Usuario:</span>
                                            <span >
                                                <textbox id="usuarior"   maxlength="30" cols="15" readonly="true"  />
                                                Clave:
                                                <textbox id="claver"   maxlength="30" cols="15" readonly="true"  />
                                                <button label="Generar" onClick="generarClaveRep(true);"/>
                                            </span>
                                            <span> </span>

                                            <span></span>
                                        </row>
                                
                                    
                                    </rows>
                                </grid>
                            </panelchildren>
                        </panel>
                        <panel collapsible="true" framable="true"  title="FACTURAR A" border="normal" >
                            <panelchildren>
                                <grid sclass="MyGridRowHeight">
                                    <rows>
                                        <row>
                                            <span style="color:blue;float:right" >COPIAR DE: </span>
                                            <span>
                                                <button id="padrec" label="Padre"  disabled="true" onClick="copiarp();"/>
                                                <button id="madrec" label="Madre"  disabled="true"  onClick="copiarm();"/>
                                                <button id="representantec" label="Representante" disabled="true"  onClick="copiarr();"/>
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> Tipo:</span>
                                            <span>
                                                <listbox mold="select" onSelect="llenarConsumidor();" disabled="true" id="tipofac" width="150px">
                                                    <listitem label="CEDULA" value="C">
                                                    </listitem>
                                                    <listitem label="RUC" value="R">
                                                    </listitem>
                                                    <listitem label="PASAPORTE" value="P">
                                                    </listitem>
                                                </listbox>
                                         
                                                Identificación:
                                                <textbox maxlength="13" cols="13"  readonly="true" id="cedulafac"  />
                                            </span>
                                        </row>
                                        <row>
                                            <span style="float:right"> Nombre Factura:</span>
                                            <textbox id="nombresfac"  maxlength="100" cols="40" readonly="true"   />
                                        </row>
                                        <row>
                                            <span style="float:right"> Dirección:</span>
                                            <span>
                                                <textbox id="direccionfac" maxlength="100" cols="30"  readonly="true"    />
                                        
                                                <span> Teléfono:</span>
                                                <textbox id="telefonofac" maxlength="30" cols="13"  readonly="true"  /> 
                                            </span>
                                        </row>
                                       
                                    </rows>
                                </grid>
                            </panelchildren>
                        </panel>
                         
                                <panel style="margin-bottom:10px" title="HERMANOS: " border="normal">
                                        <panelchildren>            
                                         
                                                        <label></label>
                                                    <span >No. de Hermanos(*) </span>
                                                    <intbox id="hermanos"  />
                                                    Ingrese los hermanos en la institución
                                                           
                                          
                                            <grid  width="100%" id="hermanos2">
                                                <columns sizable="true">
                                                    <column visible="false" label="codigo" />
                                                    <column style="font-weight:bold" label="APELLIDOS Y NOMBRES" width="120px" />
                                                    <column label="AÑO DE BÁSICA" width="50px"  />
                                                </columns>
                                                <rows>
                                                    <row>
                                                        <intbox id="codh1" value="0"/>
                                                        <combobox  readonly="true"   cols="40" id="nomh1"   
                                                        onSelect='try{ codh1.value = (self.selectedItem.value).getCodigoest(); }catch(Exception e){ codh1.value=0; nomh1.value = "";}'  
                                                            autodrop="true" buttonVisible="false"  use="bean.AutoCompleteEstudiante"/>
                                                        <textbox id="anioh1" value=""  readonly="true" />
                                                    </row>
                                                    <row>
                                                        <intbox id="codh2" value="0"/>
                                                        <combobox readonly="true"    cols="40" id="nomh2" onSelect="codh2.value = (self.selectedItem.value).getCodigoest()"   
                                                            autodrop="true" buttonVisible="false"  use="bean.AutoCompleteEstudiante"/>
                                                        <textbox id="anioh2" value=""  readonly="true" />
                                                    </row>
                                                    <row>
                                                        <intbox id="codh3" value="0"/>
                                                        <combobox  readonly="true"   cols="40" id="nomh3"  onSelect="codh3.value = (self.selectedItem.value).getCodigoest()"  
                                                          autodrop="true" buttonVisible="false"  use="bean.AutoCompleteEstudiante"/>
                                                        <textbox id="anioh3" value=""  readonly="true" />
                                                    </row>
                                            
                                                </rows>
                                            </grid>
                                        </panelchildren>
                                    </panel>   
                                    
                                      <panel style="margin-bottom:10px" title="PERSONAS AUTORIZADAS A RETIRAR AL ESTUDIANTE: " border="normal">
                                            <panelchildren>
                                                <grid  width="100%" id="opciones2">
                                                 
                                                    <columns sizable="true">
                                                        <column label="codigo" visible="false"/>
                                                        <column label="NOMBRES" width="120px" />
                                                        <column label="PARENTESCO" width="50px"  />
                                                        <column label="C.I."  width="30px" />
  
                                                    </columns>
                                                    <rows id="filas2">
                                                        <row>
                                                            <intbox id="cod11" value="0"/>
                                                            <textbox readonly="true"  id="nom11" cols="30" value=""/>
                                                            <textbox readonly="true"  id="par11" value=""/>
                                                            <textbox readonly="true"  id="ci11" cols="10" value=""/>
                                                        </row>
                                                        <row>
                                                            <intbox id="cod22" value="0"/>
                                                            <textbox readonly="true"  id="nom22" cols="30"  value=""/>
                                                            <textbox readonly="true"  id="par22"  value=""/>
                                                            <textbox readonly="true"  id="ci22" cols="10" value=""/>
                                                        </row>
                                                        <row>
                                                            <intbox id="cod33" value="0"/>
                                                            <textbox readonly="true"  id="nom33" cols="30"  value=""/>
                                                            <textbox  readonly="true" id="par33"  value=""/>
                                                            <textbox  readonly="true" id="ci33" cols="10"  value=""/>
                                                        </row>
                                            
                                                    </rows>
                                                </grid>
                                            </panelchildren>
                                        </panel>
                                     
                    
                    </portalchildren>
                </portallayout>

                <panel height="370px" visible="false" style="margin-bottom:10px"
                       title="Búsquedas" border="normal">
                    <panelchildren>
                        <vbox width="100%">
                            <hbox > INGRESE UN APELLIDO:
                                <textbox id="buscarText"   onOK="buscar(self.getValue());"   maxlength="60" cols="40" />
                                <button id="buscar" label="Buscar" onClick="buscar(buscarText.getValue());"/>
                            </hbox>
                            <hbox width="100%">
                                <listbox mold="paging"  rows="15"   pageSize="15" onSelect="move();estado(true,false);eliminar.disabled=false;guardar.disabled=true" id="datos" width="100%">
                                    <listhead>
                                        <listheader label="Cod."/>
                                        <listheader label="Nombres"  sort="auto"/>
                                        <listheader label="Dirección"/>
                                    </listhead>
                                    <listitem forEach="${allEvents}" value="${each}">
                                        <listcell label="${each.cedula}" />
                                        <listcell label="${each.apellido} ${each.nombre}" />
                                        <listcell label="${each.direccion}" />
                                    </listitem>
                                </listbox>


                            </hbox>
                        </vbox>
                    </panelchildren>
                </panel>

             
    </vbox>

    <vbox id="botones2">
        <hbox>
            <button image="/images/guardar.gif" id="guardar" label="Guardar"  disabled="true"  onClick="guardar();"/>
            <button  image="/images/nuevo.gif" id="agregar" label="Agregar" onClick='cargandoFoto = false;combo.value="";nuevo();'  />
            <button  image="/images/editar.gif" id="modificar"  label="Modificar" disabled="true" onClick="modificar()"/>
            <button  image="/images/imprimir.gif" id="acta"  label="Acta" disabled="true"  onClick='showReport("AM"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false;separador.visible=false;  '/>
            <button  image="/images/imprimir.gif" id="certificado"  label="Certificado" disabled="true"  onClick='showReport("CM"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false;separador.visible=false;  ' />
            <button  image="/images/imprimir.gif" id="certificado2"  label="Certificado2" disabled="true"  onClick='showReport("CM2"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false;separador.visible=false;  '/>
            <button  image="/images/imprimir.gif" id="claveprint"  label="Clave" disabled="true"  onClick='showReport("CL"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false;separador.visible=false;  ' />
            <button  image="/images/imprimir.gif" id="carnetprint"  label="Carnét" disabled="false"  onClick='showReport("CAR"); contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false;separador.visible=false;  ' />
            <button  image="/images/imprimir.gif" id="carnetprintm"  label="Carnét M." disabled="false"  onClick='showReport("CARM");  contenidoReporte.visible=true; contenido.visible=false; botones1.visible=false; botones2.visible=false; separador.visible=false; ' />
            <button  image="/images/eliminar.gif" id="eliminar"  label="Eliminar(Matricula)" disabled="true"  onClick="eliminar();"/>
        </hbox>
    </vbox>
    <vbox >
        <separator id="separador" height="40px"> </separator>
    </vbox>
            <panel height="100%" visible="false"  id="contenidoReporte">
                <toolbar align="center">
		   <button width="400px" image="/images/exit.gif" id="Cerrar"  label="CERRAR EL REPORTE"  
           onClick="contenidoReporte.visible=false; contenido.visible=true; botones1.visible=true; botones2.visible=true; separador.visible=true;  "/>
            	</toolbar>
                    <panelchildren>

                        <jasperreport id="report" />
                    </panelchildren>
                </panel>
        
    
    <zscript>
        import fotos.takePicture;
        byte[] datosIm  = null;
        takePicture t = new takePicture();
    
        void llenar(){
        datosIm = t.procesar();
        if(datosIm != null){
        foto0.visible = true;
        foto0.setContent(new org.zkoss.image.AImage("fotito", datosIm));
        camara.visible = false;
        btomar.visible = true;
        bcorrecto.visible = true;
        cargandoFoto = true;
        combo.value="";nuevo();
        }else{
        //foto0.visible = false;
        camara.visible = true;
        btomar.visible = false;
        bcorrecto.visible = false;
        cargandoFoto = false;
        }
            
        
        }
        
        void megusta(){
              
        }
        
        
    </zscript>
        
        
</window>
  